<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

<script src="libs/html2canvas.min.js"></script>
<script src="libs/jspdf.umd.min.js"></script>



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e1e2e;
            color: white;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .container {
            background: #282a36;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 700px;
        }

       h1, h2 {
    text-align: center;
    font-size: 30px;
    font-weight: bold;
    position: relative;
    margin-bottom: 20px;
}

h2::after {
    content: "";
    display: block;
    width: 60%;
    height: 5px;
    background-color: #ff79c6;
    margin: 15px auto 0;
    border-radius: 5px;
}


        label {
            display: block;
            margin-top: 15px;
            font-size: 30px;
        }

        select, input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            border: none;
            font-size: 16px;
        }

        textarea {
            resize: vertical;
            height: 80px;
        }

        .btn {
            background: #ff5555;
            color: white;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 20px;
            font-weight: bolder;
            width: 100%;
        }

        .btn:hover {
            background: #ff79c6;
        }


.header {
    text-align: center;
    margin-top: -20px;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 40px;
    font-weight: bold;
    margin: 10px 0 5px;
    color: #ffffff;
}

.header h2 {
    font-size: 30px;
    font-weight: bold;
    margin: 0;
    color: #ffffff;
}

.dtc {
    font-size: 30px;
    color: #ff79c6;
    font-weight: bold;
}


select, input[type="text"], textarea {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 5px;
    border: none;
    font-size: 25px;
    font-weight: bold;
    color: #000; /* Ù„ÙˆÙ† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª */
}



input[list], select {
    font-size: 20px;
    font-weight: bold;
    height: 50px;
    padding: 10px;
    border-radius: 5px;
    width: 100%;
    box-sizing: border-box;
}


#evaluationModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.85);
    display: flex; /* Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† none Ù…Ø¤Ù‚ØªØ§Ù‹ */
    justify-content: center;
    align-items: flex-start; /* âœ… Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    z-index: 9999;
    padding-top: 40px; /* Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
}


#evaluationsDisplay {
    width: 98%;
    height: 95%;
    background-color: transparent;
    border-radius: 15px;
    overflow-y: auto;
    padding: 30px;
    direction: rtl;
    margin: auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

#evaluationsDisplay table {
    width: 100%;
    border-collapse: collapse;
    font-size: 30px; /* âœ… ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· */
    font-weight: bold;
    background-color: #ffffff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    color: #111;
}

#evaluationsDisplay th {
    background-color: #004466;
    color: white;
    padding: 15px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 21px;
}

#evaluationsDisplay td {
    background-color: #ffffff;
    color: #111;
    padding: 14px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 20px;
}

#evaluationsDisplay thead {
    position: sticky;
    top: 0;
    z-index: 1;
}

#evaluationsDisplay tbody tr:nth-child(even) {
    background-color: #f5f5f5;
}

#evaluationsDisplay tbody tr:hover {
    background-color: #d0f0ff;
}







    </style>
</head>
<body>

    
    <div class="container">
<div class="header">
    <h1>Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù Ø¨Ø·Ù†Ø·Ø§</h1>
    <h2>Drainage Training Center - Tanta <span class="dtc">(DTC)</span></h2>
</div>
        <h2>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h2>

        <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨:</label>
        <input type="text" id="traineeName">

        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
        <input type="text" id="traineePhone">

        <label>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©:</label>
<input type="text" id="courseName" list="courseList" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
<datalist id="courseList"></datalist>

        <label>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨:</label>
        <select id="trainerRating">
            <option>Ù…Ù…ØªØ§Ø²</option>
            <option>Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
            <option>Ø¬ÙŠØ¯</option>
            <option>Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option>Ø¶Ø¹ÙŠÙ</option>
        </select>

        <label>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©:</label>
        <select id="contentRating">
            <option>Ù…Ù…ØªØ§Ø²</option>
            <option>Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
            <option>Ø¬ÙŠØ¯</option>
            <option>Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option>Ø¶Ø¹ÙŠÙ</option>
        </select>

        <label>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù‚Ø§Ù…Ø© ÙˆØ§Ù„ØªÙ†Ø¸ÙŠÙ…:</label>
        <select id="timeRating">
            <option>Ù…Ù…ØªØ§Ø²</option>
            <option>Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
            <option>Ø¬ÙŠØ¯</option>
            <option>Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option>Ø¶Ø¹ÙŠÙ</option>
        </select>

        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label>
        <textarea id="comments" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¥Ù† ÙˆØ¬Ø¯Øª..."></textarea>

        <button class="btn" onclick="submitEvaluation()">
  ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
</button>

<button class="btn" onclick="showEvaluations()">
  ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
</button>

<button class="btn" onclick="backupData()">
  ğŸ’¾ Ø¹Ù…Ù„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
</button>

<button class="btn" onclick="restoreData()">
  â™»ï¸ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
</button>



    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
<div id="evaluationModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#1e1e2ecc; z-index:1000; padding:10px; overflow-y:auto;">
<div style="
    position: relative;
    background: #282a36;
    border-radius: 10px;
    padding: 20px;
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
">
        
        <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ…Ø­Ø§Ø°ÙŠ Ù„Ù‡ -->
        <button onclick="closeEvaluations()" 
            style="
                position: absolute;
                top: 5px;
                right: 10px;
                background: #ff5555;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                display: flex;
                align-items: center;
                gap: 8px;
                transition: background 0.3s ease;
            "
            onmouseover="this.style.background='#ff3333';"
            onmouseout="this.style.background='#ff5555';">
            <span style="font-weight: bold; font-size: 18px;">&#10005;</span>
            Ø¥ØºÙ„Ø§Ù‚
        </button>

        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
        <h2 style="text-align:center; margin-top:10px; margin-bottom:10px; font-size:30px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>

       <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px;">
  <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¯ÙˆØ±Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø¨..." 
    style="padding: 10px; width: 300px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;">
  <button onclick="searchEvaluations()" 
    style="padding: 10px 20px; font-size: 20px; border-radius: 5px; background-color: #004466; color: white; cursor: pointer;">
    ğŸ” Ø¨Ø­Ø«
  </button>
  <button onclick="printSearchResults()" 
    style="padding: 10px 20px; font-size: 20px; border-radius: 5px; background-color: #00695c; color: white; cursor: pointer;">
    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF
  </button>
</div>





        <div id="evaluationsDisplay"></div>
    </div>
</div>


  <!-- Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
  <div style="
  position: absolute;
  top: 80px; /* Ø£Ù†Ø²Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ù„Ø£Ø³ÙÙ„ */
  left: 70px;
  font-size: 14px; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· */
  font-weight: 800;
    background: whitesmoke;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  user-select: none;
">

    ğŸ¨     Designed by Ahmed Amer


  

   
  <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
  <img src="logo.jpg" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" style="
    top: 80;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  ">


  </div>
<div style="
  position: fixed;
  top: 80px;
  right: 80px;
  font-size: 100px;
  font-weight: bold;
  color: gold;
">
  ğŸ“ 
</div>


<script>
document.body.addEventListener("click", function () {
    if (!document.fullscreenElement) {
        const elem = document.documentElement; // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… body Ø£ÙŠØ¶Ø§Ù‹
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) { // Safari
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { // IE11
            elem.msRequestFullscreen();
        }
    }
});
</script>

    <script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
    let db;
    const request = indexedDB.open("CourseEvaluationDB", 1);

    request.onupgradeneeded = function (event) {
        db = event.target.result;
        if (!db.objectStoreNames.contains("Evaluations")) {
            db.createObjectStore("Evaluations", { keyPath: "id", autoIncrement: true });
        }
    };

    request.onsuccess = function (event) {
        db = event.target.result;
        console.log("âœ… ØªÙ… ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.");
    };

    request.onerror = function () {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.");
    };

    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
    let courseDB;
    const courseDBRequest = indexedDB.open("CoursesDB", 1);

    courseDBRequest.onupgradeneeded = function (event) {
        courseDB = event.target.result;
        if (!courseDB.objectStoreNames.contains("courses")) {
            courseDB.createObjectStore("courses", { keyPath: "name" });
        }
    };

    courseDBRequest.onsuccess = function (event) {
        courseDB = event.target.result;
        loadCourses(); // ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    };

    courseDBRequest.onerror = function () {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª.");
    };

    function saveCourseName(courseName) {
        const tx = courseDB.transaction("courses", "readwrite");
        const store = tx.objectStore("courses");
        const getReq = store.get(courseName);
        getReq.onsuccess = function () {
            if (!getReq.result) {
                store.add({ name: courseName });
            }
        };
    }

    function loadCourses() {
        const tx = courseDB.transaction("courses", "readonly");
        const store = tx.objectStore("courses");
        const request = store.openCursor();
        const dataList = document.getElementById("courseList");
        dataList.innerHTML = "";
        request.onsuccess = function (e) {
            const cursor = e.target.result;
            if (cursor) {
                const option = document.createElement("option");
                option.value = cursor.value.name;
                dataList.appendChild(option);
                cursor.continue();
            }
        };
    }

    function submitEvaluation() {
        const traineeName = document.getElementById("traineeName").value.trim();
        const traineePhone = document.getElementById("traineePhone").value.trim();
        const courseName = document.getElementById("courseName").value;
        const trainerRating = document.getElementById("trainerRating").value;
        const contentRating = document.getElementById("contentRating").value;
        const timeRating = document.getElementById("timeRating").value;
        const comments = document.getElementById("comments").value.trim();

        if (!traineeName || !traineePhone) {
            alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.");
            return;
        }

        // âœ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª
        saveCourseName(courseName);

        const evaluation = {
            name: traineeName,
            phone: traineePhone,
            course: courseName,
            trainer: trainerRating,
            content: contentRating,
            time: timeRating,
            comments: comments,
            date: new Date().toISOString()
        };

        const transaction = db.transaction(["Evaluations"], "readwrite");
        const store = transaction.objectStore("Evaluations");
        const addRequest = store.add(evaluation);

        addRequest.onsuccess = function () {
            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­. Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ!");
            document.getElementById("traineeName").value = "";
            document.getElementById("traineePhone").value = "";
            document.getElementById("courseName").value = "";
            document.getElementById("trainerRating").selectedIndex = 0;
            document.getElementById("contentRating").selectedIndex = 0;
            document.getElementById("timeRating").selectedIndex = 0;
            document.getElementById("comments").value = "";
        };

        addRequest.onerror = function () {
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        };
    }

  function showEvaluations() {
    const modal = document.getElementById("evaluationModal");
    const displayDiv = document.getElementById("evaluationsDisplay");
    modal.style.display = "block";
    displayDiv.innerHTML = "<p style='text-align:center;'>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...</p>";

    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (!db) {
        const request = indexedDB.open("CourseEvaluationDB", 1);

        request.onsuccess = function (event) {
            db = event.target.result;
            loadEvaluations(); // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©ØŒ Ù†Ø³ØªØ¯Ø¹ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø©
        };

        request.onerror = function () {
            displayDiv.innerHTML = "<p>ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
        };
    } else {
        loadEvaluations(); // Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ÙØ¹Ù„
    }

    // âœ… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
    function loadEvaluations() {
        const transaction = db.transaction(["Evaluations"], "readonly");
        const store = transaction.objectStore("Evaluations");
        const request = store.getAll();

        request.onsuccess = function (event) {
            const evaluations = event.target.result;

            if (evaluations.length === 0) {
                displayDiv.innerHTML = "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
                return;
            }

            let html = `
                <table style="width: 100%; border-collapse: collapse; background: #444; color: white; border-radius: 10px; overflow: hidden; font-size: 18px;">
                    <thead>
                        <tr style="background: #ff5555; text-align: center;">
                            <th style="padding: 12px;">Ø§Ù„Ø§Ø³Ù…</th>
                            <th style="padding: 12px;">Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th style="padding: 12px;">Ø§Ù„Ø¯ÙˆØ±Ø©</th>
                            <th style="padding: 12px;">Ø§Ù„Ù…Ø¯Ø±Ø¨</th>
                            <th style="padding: 12px;">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</th>
                            <th style="padding: 12px;">Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© ÙˆØ§Ù„ØªÙ†Ø¸ÙŠÙ…</th>
                            <th style="padding: 12px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th style="padding: 30px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            evaluations.forEach(ev => {
                html += `
                    <tr style="border-top: 1px solid #666; text-align: center;">
                        <td style="padding: 12px;">${ev.name}</td>
                        <td style="padding: 12px;">${ev.phone}</td>
                        <td style="padding: 12px;">${ev.course}</td>
                        <td style="padding: 12px;">${ev.trainer}</td>
                        <td style="padding: 12px;">${ev.content}</td>
                        <td style="padding: 12px;">${ev.time}</td>
                        <td style="padding: 12px;">${ev.comments || "-"}</td>
                        <td style="padding: 12px; font-size: 14px;">${new Date(ev.date).toLocaleString("ar-EG")}</td>
                    </tr>
                `;
            });

            html += `</tbody></table>`;
            displayDiv.innerHTML = html;
        };

        request.onerror = function () {
            displayDiv.innerHTML = "<p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.</p>";
        };
    }
}


function closeEvaluations() {
    document.getElementById("evaluationModal").style.display = "none";
}



function searchEvaluations() {
  const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
  const display = document.getElementById("evaluationsDisplay");

  if (!searchTerm) return;

  const request = indexedDB.open("CourseEvaluationDB", 1);

  request.onsuccess = function (event) {
    const db = event.target.result;
    const transaction = db.transaction("Evaluations", "readonly");
    const store = transaction.objectStore("Evaluations");

    const results = [];
    store.openCursor().onsuccess = function (event) {
      const cursor = event.target.result;
      if (cursor) {
        const item = cursor.value;

        // Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
        const values = [
          item.name,
          item.phone,
          item.course,
          item.trainer,
          item.content,
          item.time,
          item.comments,
          item.date
        ];

        const match = values.some(v => v && v.toLowerCase().includes(searchTerm));
        if (match) results.push(item);

        cursor.continue();
      } else {
        displaySearchResults(results);
      }
    };
  };

  request.onerror = function () {
    display.innerHTML = "<p>ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.</p>";
  };
}



function displaySearchResults(dataArray) {
  const container = document.getElementById("evaluationsDisplay");

  if (dataArray.length === 0) {
    container.innerHTML = "<p style='color:white; text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</p>";
    return;
  }

  let html = `
    <table style="width: 100%; border-collapse: collapse; background: #444; color: white; font-size: 18px;">
      <thead>
        <tr style="background: #007bff;">
          <th style="padding:10px;">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</th>
          <th style="padding:10px;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th style="padding:10px;">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th>
          <th style="padding:10px;">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨</th>
          <th style="padding:10px;">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
          <th style="padding:10px;">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù‚Ø§Ù…Ø© ÙˆØ§Ù„ØªÙ†Ø¸ÙŠÙ…</th>
          <th style="padding:10px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th style="padding:10px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        </tr>
      </thead>
      <tbody>
  `;

  dataArray.forEach(item => {
    html += `
      <tr style="text-align: center; border-top: 1px solid #666;">
        <td style="padding:10px;">${item.name || ""}</td>
        <td style="padding:10px;">${item.phone || ""}</td>
        <td style="padding:10px;">${item.course || ""}</td>
        <td style="padding:10px;">${item.trainer || ""}</td>
        <td style="padding:10px;">${item.content || ""}</td>
        <td style="padding:10px;">${item.time || ""}</td>
        <td style="padding:10px;">${item.comments || "-"}</td>
        <td style="padding:10px;">${new Date(item.date).toLocaleString("ar-EG")}</td>
      </tr>
    `;
  });

  html += "</tbody></table>";
  container.innerHTML = html;
}



function printSearchResults() {
  const displayDiv = document.getElementById("evaluationsDisplay");

  // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù†ØªØ§Ø¦Ø¬
  if (!displayDiv || displayDiv.innerText.trim() === "" || displayDiv.innerText.includes("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬")) {
    alert("No results to print.");
    return;
  }

  // Ø§Ø³ØªØ®Ø¯Ù… html2canvas Ùˆ jsPDF
  html2canvas(displayDiv).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("l", "mm", "a4");

    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
    const now = new Date();
    const formattedDate = now.toLocaleString("en-GB", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    }).replace(",", " -");

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    pdf.setFont("Helvetica", "bold");
    pdf.setFontSize(20);
// Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ®
pdf.setFont("Helvetica", "bold");
pdf.setFontSize(20);
pdf.text(`Course Evaluation Form - ${formattedDate}`, pdfWidth / 2, 15, { align: "center" });

// Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ
pdf.setFontSize(19);
pdf.text("Drainage Training Center - Tanta (DTC)", pdfWidth / 2, 23, { align: "center" });

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    pdf.addImage(imgData, "PNG", 0, 25, pdfWidth, pdfHeight);
    pdf.save("Search_Results.pdf");
  });
}


function backupData() {
  const exportObj = {};

  const db1Request = indexedDB.open("CourseEvaluationDB", 1);
  db1Request.onsuccess = function (event) {
    const db1 = event.target.result;
    const tx1 = db1.transaction("Evaluations", "readonly");
    const store1 = tx1.objectStore("Evaluations");
    store1.getAll().onsuccess = function (event1) {
      exportObj["CourseEvaluationDB"] = event1.target.result;

      const db2Request = indexedDB.open("CoursesDB", 1);
      db2Request.onsuccess = function (event2) {
        const db2 = event2.target.result;
        const tx2 = db2.transaction("courses", "readonly");
        const store2 = tx2.objectStore("courses");
        store2.getAll().onsuccess = function (event3) {
          exportObj["CoursesDB"] = event3.target.result;

          // ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù
          const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
          const downloadAnchor = document.createElement("a");
          downloadAnchor.setAttribute("href", dataStr);
          downloadAnchor.setAttribute("download", "backup_indexeddb.json");
          document.body.appendChild(downloadAnchor);
          downloadAnchor.click();
          document.body.removeChild(downloadAnchor);
        };
      };
    };
  };
}

function restoreData() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json";

  input.onchange = function (event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const jsonData = JSON.parse(e.target.result);

      // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‚Ø§Ø¹Ø¯Ø© CourseEvaluationDB
      const db1Request = indexedDB.open("CourseEvaluationDB", 1);
      db1Request.onsuccess = function (event1) {
        const db1 = event1.target.result;
        const tx1 = db1.transaction("Evaluations", "readwrite");
        const store1 = tx1.objectStore("Evaluations");

        jsonData["CourseEvaluationDB"].forEach(item => {
          store1.put(item);
        });

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© CoursesDB
        const db2Request = indexedDB.open("CoursesDB", 1);
        db2Request.onsuccess = function (event2) {
          const db2 = event2.target.result;
          const tx2 = db2.transaction("courses", "readwrite");
          const store2 = tx2.objectStore("courses");

          jsonData["CoursesDB"].forEach(item => {
            store2.put(item);
          });

          alert("âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.");
        };
      };
    };
    reader.readAsText(file);
  };

  input.click();
}




</script>



<script>
    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let db;
    const request = indexedDB.open("CourseEvaluationDB", 1);

    request.onupgradeneeded = function (event) {
        db = event.target.result;
        if (!db.objectStoreNames.contains("Evaluations")) {
            db.createObjectStore("Evaluations", { keyPath: "id", autoIncrement: true });
        }
    };

    request.onsuccess = function (event) {
        db = event.target.result;
        console.log("âœ… ØªÙ… ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.");
        fetchAndStoreData();
    };

    request.onerror = function () {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.");
    };

    function fetchAndStoreData() {
        fetch("https://script.google.com/macros/s/AKfycbz1LoEPJYiPa0ptSxef9riXHt4zuPZk39BdjlcEXvvtspiGVGDt-r4Eq0DZnYfn7ZnuPw/exec")
            .then(response => response.json())
            .then(data => {
                const tx = db.transaction("Evaluations", "readwrite");
                const store = tx.objectStore("Evaluations");

                // Ø§Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…
                store.clear();

                // Ø£Ø¶Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
                data.forEach((row, index) => {
                    const record = {
                        id: index + 1,
                        name: row["ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… "] || "",
                        phone: row["ğŸ“  Ø§Ù„Ù‡Ø§ØªÙ"] || "",
                        email: row["ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"] || "",
                        department: row["ğŸ¢ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"] || "",
                        qualification: row["ğŸ“ Ø§Ù„Ù…Ø¤Ù‡Ù„"] || "",
                        jobTitle: row["ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©"] || "",
                        residencyStatus: row["ğŸ¨  Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©"] || "",
                        courseName: row["ğŸ“˜ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©"] || "",
                        startDate: row["ğŸ“…  Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©"] || "",
                        endDate: row["ğŸ“…  Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©"] || "",
                        trainerRating: row["ğŸ§‘â€ğŸ«  Ø§Ù„Ù…Ø¯Ø±Ø¨"] || "",
                        contentRating: row["ğŸ“–  Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©"] || "",
                        organizationRating: row["ğŸ¢  Ø§Ù„ØªÙ†Ø¸ÙŠÙ…  "] || "",
                        residencyRating: row["ğŸ¨  Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©"] || "",
                        comments: row["ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª "] || "",
                        timestamp: row["ğŸ“…  ÙˆØ§Ù„ÙˆÙ‚Øª"] || ""
                    };

                    store.add(record);
                });

                tx.oncomplete = () => {
                    console.log("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù† Google Sheet.");
                };
            })
            .catch(error => {
                console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheet:", error);
            });
    }
</script>


</body>
</html>
