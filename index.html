<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");
    const submitBtn = form.querySelector("button[type='submit']");

    form.addEventListener("submit", function () {
      submitBtn.disabled = true;
      submitBtn.textContent = "📤 جارٍ الإرسال..."; // يمكن تعديل النص حسب الحاجة
    });
  });
</script>


  <title>نموذج تقييم الدورة</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2e;
      color: white;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: #282a36;
      padding: 30px;
      border-radius: 10px;
      width: 100%;
      max-width: 750px;
      font-size: 20px;
    }

    h2 {
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-size: 22px;
    }

    select, input[type="text"], input[type="date"], input[type="email"], textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border-radius: 5px;
      border: none;
      font-size: 20px;
      font-weight: bold;
      color: #000;
    }

    textarea {
      resize: vertical;
      height: 100px;
    }

    .btn {
      background: #ff5555;
      color: white;
      border: none;
      padding: 15px 25px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 25px;
      font-size: 22px;
      font-weight: bold;
      width: 100%;
    }

    .btn:hover {
      background: #ff79c6;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 34px;
      font-weight: bold;
      color: #ffffff;
      margin-bottom: 5px;
    }

    .header h2 {
      font-size: 26px;
      font-weight: bold;
      color: #ffffff;
    }

    .dtc {
      color: #ff79c6;
    }

@media (max-width: 600px) {
  .logo-container img {
    width: 50px !important;
    height: 50px !important;
  }

  .design-text {
    font-size: 10px !important;
    left: 20px !important;
    top: 60px !important;
  }

  .emoji-icon {
    font-size: 50px !important;
    top: 40px !important;
    right: 30px !important;
  }
}
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.body.addEventListener("click", function () {
        const elem = document.documentElement;
        if (
          !document.fullscreenElement &&
          !document.webkitFullscreenElement &&
          !document.msFullscreenElement
        ) {
          if (elem.requestFullscreen) {
            elem.requestFullscreen();
          } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen(); // Safari
          } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen(); // IE11
          } else {
            alert("المتصفح لا يدعم fullscreen.");
          }
        }
      }, { once: true });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      fetch("https://script.google.com/macros/s/AKfycbw5P1p8vgWYf40hBzsSSUhK8ykZWdumWd5GAUuRbsyl5ur8-qyS4_4xoYhCiFQ2PL7UuQ/exec")
        .then(response => response.json())
        .then(data => {
          const datalist = document.getElementById("courseList");
          data.forEach(course => {
            const option = document.createElement("option");
            option.value = course;
            datalist.appendChild(option);
          });
        })
        .catch(error => console.error("❌ خطأ في تحميل أسماء الدورات:", error));
    });
  </script>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>مركز تدريب الصرف بطنطا</h1>
      <h2>Drainage Training Center - Tanta <span class="dtc">(DTC)</span></h2>
    </div>

    <h2>📝 نموذج تقييم الدورة التدريبية</h2>

    <form action="https://script.google.com/macros/s/AKfycbw5P1p8vgWYf40hBzsSSUhK8ykZWdumWd5GAUuRbsyl5ur8-qyS4_4xoYhCiFQ2PL7UuQ/exec" method="post">
      <label>👤 اسم المتدرب:</label>
      <input type="text" name="traineeName" placeholder="ادخل اسمك الكامل" required>

      <label>📱 رقم الهاتف:</label>
      <input type="text" name="traineePhone" placeholder="ادخل رقم الهاتف" required>

      <label>📧 البريد الإلكتروني:</label>
<input type="email" name="traineeEmail" value="tantadtc@gmail.com" readonly>



      <label>🏢 الإدارة - الإقليم:</label>
      <input type="text" name="department" placeholder="ادخل اسم الإدارة" required>

      <label>🎓 المؤهل:</label>
      <input type="text" name="qualification" placeholder="ادخل المؤهل الدراسي" required>

      <label>💼 الوظيفة:</label>
      <input type="text" name="jobTitle" placeholder="ادخل الوظيفة الحالية" required>

      <label>🏨 حالة الإقامة:</label>
<select name="residencyStatus" required>
  <option value="">اختر الحالة</option>
  <option value="مقيم">مقيم</option>
  <option value="مقيمة">مقيمة</option>
  <option value="غير مقيم">غير مقيم</option>
  <option value="غير مقيمة">غير مقيمة</option>
</select>


<style>
  select:disabled {
    background-color: white;
    color: black;
  }
</style>

<label>📘 اسم الدورة:</label>
<select id="courseName" name="courseName" required>
  <option value="">اختر اسم الدورة</option>
</select>

<br><br>

<label>📅 تاريخ بداية الدورة:</label>
<select id="courseStartDate" name="courseStartDate" disabled required>
  <option value="">---</option>
</select>

<br><br>

<label>📅 تاريخ نهاية الدورة:</label>
<select id="courseEndDate" name="courseEndDate" disabled required>
  <option value="">---</option>
</select>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 🗂️ الدورات وتواريخها
    const courseData = {
      "  Ms Excel ": { start: "2025-9-28", end: "2025-10-2" },

    };

    const courseSelect = document.getElementById("courseName");
    const startSelect = document.getElementById("courseStartDate");
    const endSelect = document.getElementById("courseEndDate");

    // 🧩 توليد أسماء الدورات تلقائيًا
    Object.keys(courseData).forEach(courseName => {
      const option = document.createElement("option");
      option.value = courseName;
      option.textContent = courseName;
      courseSelect.appendChild(option);
    });

    courseSelect.addEventListener("change", function () {
      const selectedCourse = this.value;

      // إعادة تعيين القوائم
      startSelect.innerHTML = '<option value="">---</option>';
      endSelect.innerHTML = '<option value="">---</option>';

      if (selectedCourse && courseData[selectedCourse]) {
        const startDate = courseData[selectedCourse].start;
        const endDate = courseData[selectedCourse].end;

        // توليد خيار واحد لكل من البداية والنهاية
        const startOption = document.createElement("option");
        startOption.value = startDate;
        startOption.textContent = startDate;
        startSelect.appendChild(startOption);

        const endOption = document.createElement("option");
        endOption.value = endDate;
        endOption.textContent = endDate;
        endSelect.appendChild(endOption);

        startSelect.disabled = false;
        endSelect.disabled = false;

        // تعيين القيم تلقائيًا
        startSelect.value = startDate;
        endSelect.value = endDate;
      } else {
        startSelect.disabled = true;
        endSelect.disabled = true;
      }
    });
  });
</script>


<script>
  // 🗄️ IndexedDB Setup
  let db;
  const request = indexedDB.open("myNewDB", 1); // 👈 اسم جديد للداتا بيز

  request.onupgradeneeded = function (event) {
    db = event.target.result;
    if (!db.objectStoreNames.contains("records")) { // 👈 اسم جديد للمستودع
      db.createObjectStore("records", { keyPath: "id", autoIncrement: true });
    }
  };

  request.onsuccess = function (event) {
    db = event.target.result;
    console.log("✅ IndexedDB جاهز");
  };

  request.onerror = function () {
    console.error("❌ خطأ في IndexedDB");
  };

  // 📝 حفظ البيانات أوفلاين فقط
  function saveOffline(formData) {
    const transaction = db.transaction(["records"], "readwrite"); // 👈 اسم المستودع الجديد
    const store = transaction.objectStore("records");
    store.add(formData);
    console.log("💾 اتحفظ أوفلاين:", formData);
  }

  // ☁️ محاولة إرسال للـ Google Sheet
  function sendToGoogleSheets(formData, callback) {
    fetch("https://script.google.com/macros/s/AKfycbw5P1p8vgWYf40hBzsSSUhK8ykZWdumWd5GAUuRbsyl5ur8-qyS4_4xoYhCiFQ2PL7UuQ/exec", {
      method: "POST",
      body: new URLSearchParams(formData)
    })
    .then(res => res.text())
    .then(txt => {
      console.log("رد السيرفر:", txt);
      if (txt.includes("success") || txt.includes("تم")) {
        if (callback) callback(true);
      } else {
        if (callback) callback(false);
      }
    })
    .catch(() => {
      if (callback) callback(false);
    });
  }

  // 🔄 مزامنة كل السجلات مع إعادة المحاولة
  function syncPendingData() {
    const transaction = db.transaction(["records"], "readwrite"); // 👈 نفس التغيير
    const store = transaction.objectStore("records");
    const getAll = store.getAll();

    getAll.onsuccess = function () {
      const items = getAll.result;
      if (items.length === 0) {
        console.log("✅ مفيش سجلات معلقة");
        return;
      }

      let pending = items.length;
      items.forEach(item => {
        sendToGoogleSheets(item, function (success) {
          if (success) {
            store.delete(item.id);
            console.log("🗑️ اتحذف بعد المزامنة:", item);
          } else {
            console.warn("⚠️ فشل الإرسال، هنجرب تاني:", item);
          }

          pending--;
          if (pending === 0) {
            setTimeout(syncPendingData, 5000);
          }
        });
      });
    };
  }

  // تشغيل المزامنة عند رجوع الإنترنت
  window.addEventListener("online", syncPendingData);

  // 🎯 تعديل الفورم
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");

    form.addEventListener("submit", function (e) {
  if (!navigator.onLine) {
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(form).entries());
    saveOffline(formData);
    form.reset();
    alert("⚠️ مفيش إنترنت.. البيانات اتحفظت وهتتبعت تلقائي لما النت يرجع ✅");

    // 🔄 عمل Refresh للصفحة عشان النموذج يبدأ من جديد
    location.reload();
  }
});

  });
</script>

<label>🧑‍🏫 تقييم المدرب:</label>
<select name="trainerRating">
  <option value="">اختر التقييم</option>
  <option>ممتاز</option>
  <option>جيد جداً</option>
  <option>جيد</option>
  <option>مقبول</option>
  <option>ضعيف</option>
</select>

<label>📚 تقييم المادة العلمية:</label>
<select name="contentRating">
  <option value="">اختر التقييم</option>
  <option>ممتاز</option>
  <option>جيد جداً</option>
  <option>جيد</option>
  <option>مقبول</option>
  <option>ضعيف</option>
</select>

<label>🏢 تقييم التنظيم وقاعة المحاضرات:</label>
<select name="organizationRating">
  <option value="">اختر التقييم</option>
  <option>ممتاز</option>
  <option>جيد جداً</option>
  <option>جيد</option>
  <option>مقبول</option>
  <option>ضعيف</option>
</select>

<label>🏨 تقييم الإقامة:</label>
<select name="residencyRating">
  <option value="">اختر التقييم</option>
  <option>ممتاز</option>
  <option>جيد جداً</option>
  <option>جيد</option>
  <option>مقبول</option>
  <option>ضعيف</option>
</select>



      <label>📝 ملاحظات إضافية:</label>
      <textarea name="comments" placeholder="اكتب ملاحظاتك إن وجدت..."></textarea>

      <button class="btn" type="submit">📤 إرسال التقييم</button>
    </form>
  </div>

<!-- عبارة التصميم في أقصى اليسار -->
<div class="design-text" style="
  position: absolute;
  top: 80px;
  left: 70px;
  font-size: 14px;
  font-weight: 800;
  background: whitesmoke;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  user-select: none;
">
 <div class="logo-container" style="text-align: center; margin-bottom: 10px;">
  <img src="logo.jpg" alt="الشعار" style="
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  ">
  <div style="
    margin-top: 8px;
    font-size: 20px;
    font-weight: bold;
    color: #333;
    font-family: Arial, sans-serif;
  ">
    Tanta (DTC)
  </div>

</div>

<!-- أيقونة التقييم 📝 -->
<div class="emoji-icon" style="
  position: fixed;
  top: 80px;
  right: 50px;
  font-size: 70px;
  font-weight: bold;
  color: gold;
">
  📝
</div>
</body>
</html>
