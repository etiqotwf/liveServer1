<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>EduPlatform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --main:#6a1b9a;
  --light:#f5f5f5;
  --dark:#222;
}
*{box-sizing:border-box;font-family:Segoe UI,Tahoma}
body{margin:0;background:var(--light);direction:rtl}

/* Header */
#topBar{display:none}
header{
  background:#fff;
  padding:15px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
header h1{color:var(--main)}
header button{
  background:var(--main);
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
}

/* Landing */
#landing{text-align:center;padding:80px 20px}
#landing h2{font-size:36px}
#landing p{font-size:18px;color:#555}
#landing button{padding:14px 30px;font-size:18px}

/* Login */
#login{
  display:none;
  min-height:100vh;
  justify-content:center;
  align-items:center;
}
.login-box{
  background:#fff;
  padding:40px;
  width:360px;
  border-radius:12px;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
  text-align:center;
}
.login-box input{
  width:100%;
  padding:12px;
  margin-bottom:15px;
}
.login-box button{width:100%;padding:12px}

/* App */
#app{display:none}
main{display:grid;grid-template-columns:260px 1fr}
aside{background:#fff;padding:15px}
.course{border:1px solid #ddd;border-radius:8px;margin-bottom:15px;overflow:hidden}
.course img{width:100%;height:120px;object-fit:cover}
.course div{padding:10px}
section{padding:20px}
.lesson{background:#eee;padding:10px;margin-bottom:8px;cursor:pointer}
.lesson.done{background:#c8e6c9}
video{width:100%;margin-top:10px}
.admin{background:#fff;padding:15px;margin-top:20px}
</style>
</head>

<body>

<div id="topBar">
<header>

  <h1>ILC Platform</h1>

  <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</header>
</div>

<div id="landing">


<!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© Ø®Ù„Ù Ø§Ù„Ù†Øµ -->
<img src="ilc.jpg" alt="ILC Logo" style="
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 900px;       /* Ø­Ø¬Ù… Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
  opacity: 0.1;       /* Ø§Ù„Ø´ÙØ§ÙÙŠØ© */
  pointer-events: none;
  user-select: none;
  z-index: 0; /* Ø®Ù„Ù Ø§Ù„Ù†ØµÙˆØµ Ù„ÙƒÙ† ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ© */
">
  <h2> Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ø¯ÙˆÙ„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ·Ø§Ù†Ù‰ Ø¨Ø·Ù†Ø·Ø§</h2>
  <h2>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h2>
  <h2>ØªØ¹Ù„Ù… Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</h2>
  <button onclick="showLogin()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="login">
  <div class="login-box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input id="u" placeholder="teacher / student">
    <input id="p" type="password" placeholder="123">
    <button onclick="loginUser()">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<div id="app">
<main>

<aside>
  <select onchange="filterCourses(this.value)" style="width:100%;padding:10px;margin-bottom:15px">
    <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
    <option value="Programming">Programming</option>
    <option value="AI">AI</option>
    <option value="Design">Design</option>
  </select>

  <div id="courses"></div>
</aside>

<section>
  <h2 id="courseTitle">Ø§Ø®ØªØ± ÙƒÙˆØ±Ø³</h2>
  <video id="video" controls></video>
  <div id="lessons"></div>
  <div id="admin"></div>
</section>

</main>
</div>



<script>




    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø©ØŒ Ø£Ø¯Ø®Ù„ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    document.addEventListener("click", () => {
      const elem = document.documentElement; // Ø£Ùˆ document.getElementById("myForm")
      if (document.fullscreenElement) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¡ Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©

      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
      }
    });



// ===== Elements =====
const landing = document.getElementById("landing");
const loginBox = document.getElementById("login");
const app = document.getElementById("app");
const topBar = document.getElementById("topBar");
const u = document.getElementById("u");
const p = document.getElementById("p");
const coursesBox = document.getElementById("courses");
const lessonsBox = document.getElementById("lessons");
const courseTitle = document.getElementById("courseTitle");
const video = document.getElementById("video");
const admin = document.getElementById("admin");

let user = null;
let current = null;
let db;

// ===== Auth =====
function showLogin(){
  landing.style.display="none";
  loginBox.style.display="flex";
}

function loginUser(){
  if(u.value==="teacher" && p.value==="123")
    localStorage.user = JSON.stringify({role:"teacher"});
  else if(u.value==="student" && p.value==="123")
    localStorage.user = JSON.stringify({role:"student"});
  else return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø·Ø£");
  location.reload();
}

function logout(){
  localStorage.clear();
  location.reload();
}

// ===== User Check =====
const userRaw = localStorage.getItem("user");
if(!userRaw){
  landing.style.display="block";
}else{
  user = JSON.parse(userRaw);
  landing.style.display="none";
  loginBox.style.display="none";
  app.style.display="block";
  topBar.style.display="block";
}

// ===== IndexedDB =====
function openDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open("EduPlatform", 1);

    request.onerror = () => reject("ÙØ´Ù„ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    request.onsuccess = () => {
      db = request.result;
      resolve(db);
    };

    request.onupgradeneeded = (e) => {
      db = e.target.result;
      if (!db.objectStoreNames.contains("courses")) {
        const store = db.createObjectStore("courses", { keyPath: "id", autoIncrement: true });
        store.createIndex("title", "title", { unique: false });

        // Ø£Ø¶Ù ÙƒÙˆØ±Ø³ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        store.transaction.oncomplete = () => {
          const courseStore = db.transaction("courses", "readwrite").objectStore("courses");
          courseStore.add({
            title: "JavaScript Basics",
            category: "Programming",
            price: 25,
            discount: 20,
            rate: 4.8,
            img: "https://picsum.photos/400/200",
            published: true,
            lessons: [
              {
                title: "Intro",
                video: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
              }
            ],
            quiz: []
          });
        };
      }
    };
  });
}

function getAllCourses() {
  return new Promise((resolve, reject) => {
    const tx = db.transaction("courses", "readonly");
    const store = tx.objectStore("courses");
    const request = store.getAll();
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª");
  });
}


function addCourseToDB(course) {
  return new Promise(async (resolve, reject) => {
    const tx = db.transaction("courses", "readwrite");
    const store = tx.objectStore("courses");
    const request = store.add(course);
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject("ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³");
  });
}

function updateCourseInDB(course) {
  return new Promise(async (resolve, reject) => {
    const tx = db.transaction("courses", "readwrite");
    const store = tx.objectStore("courses");
    const request = store.put(course);
    request.onsuccess = () => resolve();
    request.onerror = () => reject("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ±Ø³");
  });
}

function deleteCourseInDB(id) {
  return new Promise(async (resolve, reject) => {
    const tx = db.transaction("courses", "readwrite");
    const store = tx.objectStore("courses");
    const request = store.delete(id);
    request.onsuccess = () => resolve();
    request.onerror = () => reject("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³");
  });
}

// ===== Render =====
async function loadCourses(filter="all") {
  coursesBox.innerHTML="";

  // Ø²Ø± Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ù„Ù„Ù…Ø¯Ø±Ø³
  if(user?.role === "teacher"){
    const addDiv = document.createElement("div");
    addDiv.className="course";
    addDiv.innerHTML = `<button style="width:100%;padding:12px;background:var(--main);color:#fff;border:none;border-radius:6px;cursor:pointer" onclick="promptAddCourse()">â• Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³</button>`;
    coursesBox.appendChild(addDiv);
  }

  const courses = await getAllCourses();
  const filtered = courses.filter(c => filter==="all" || c.category===filter);
  filtered.forEach((c,i)=>renderCourse(c,i));
}

function renderCourse(c,i){
  const finalPrice = c.discount ? Math.round(c.price - (c.price * c.discount / 100)) : c.price;
  const d=document.createElement("div");
  d.className="course";
  d.innerHTML=`
    <img src="${c.img}">
    <div>
      <h4>${c.title}</h4>
      <small>${c.category}</small><br>
      â­ ${c.rate || "Ø¬Ø¯ÙŠØ¯"}<br>
      <b>$${finalPrice}</b>
      ${c.discount ? `<small style="text-decoration:line-through;color:#999">$${c.price}</small>` : ""}
      <button onclick="loadCourse(${c.id})">Ø¯Ø®ÙˆÙ„</button>
    </div>
  `;
  coursesBox.appendChild(d);
}

// ===== Load Course =====
async function loadCourse(id){
  const courses = await getAllCourses();
  current = courses.find(c => c.id===id);
  courseTitle.innerText = current.title;
  lessonsBox.innerHTML="";
  video.src="";

  current.lessons.forEach((l, idx) => {
    const d = document.createElement("div");
    d.className="lesson";

    if(user.role === "teacher"){
      const delBtn = document.createElement("button");
      delBtn.innerText = "ğŸ—‘ï¸";
      delBtn.style.marginRight = "5px";
      delBtn.onclick = (e) => {
        e.stopPropagation();
        deleteLesson(idx);
      };
      d.appendChild(delBtn);
    }

    const titleSpan = document.createElement("span");
    titleSpan.innerText = l.title;
    d.appendChild(titleSpan);

    d.onclick = () => {
      video.src = l.video;
      d.classList.add("done");
    };
    lessonsBox.appendChild(d);
  });

  // Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³
  if(user.role === "teacher"){
    admin.innerHTML=`
      <div class="admin">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</h3>
        <button onclick="promptAddLesson()">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>
        <button onclick="promptDeleteCourse()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³</button>
      </div>
    `;
  } else admin.innerHTML="";
}

// ===== Add Course/Lesson/Delete =====
async function promptAddCourse(){
  const title = prompt("Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³");
  const category = prompt("Programming / AI / Design");
  const price = Number(prompt("Ø§Ù„Ø³Ø¹Ø±"));
  const discount = Number(prompt("Ø§Ù„Ø®ØµÙ… %",0));
  const img = prompt("Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©");
  if(!title||!category||isNaN(price)) return;

  const course = {title,category,price,discount,rate:0,img,published:true,lessons:[],quiz:[]};
  await addCourseToDB(course);
  loadCourses();
}

async function promptAddLesson(){
  const t = prompt("Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³");
  const v = prompt("Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
  if(!t||!v) return;
  current.lessons.push({title:t,video:v});
  await updateCourseInDB(current);
  loadCourse(current.id);
}

async function deleteLesson(idx){
  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ")) return;
  current.lessons.splice(idx,1);
  await updateCourseInDB(current);
  loadCourse(current.id);
}

async function promptDeleteCourse(){
  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
  await deleteCourseInDB(current.id);
  current=null;
  lessonsBox.innerHTML="";
  video.src="";
  courseTitle.innerText="Ø§Ø®ØªØ± ÙƒÙˆØ±Ø³";
  admin.innerHTML="";
  loadCourses();
}

// ===== Initial Load =====
(async () => {
  await openDB();
  if (user) {
    loadCourses();
  }
})();

</script>
</body>
</html>
