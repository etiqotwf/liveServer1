<!DOCTYPE html>
<html lang="ar">
<head>
<script src="xlsx.full.min.js"></script>
<script src="chart.js"></script>



  <meta charset="UTF-8">
  
  <title>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</title>
  <style>



    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      background-color: #f0f0f0;
      padding: 20px;
    }
    
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    .container {
  width: 95%; /* Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… 100% Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø£Ù† ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
  max-width: 100%; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠØ¯ Ø¨Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª */
  margin: auto;
  background-color: white;
  padding: 2px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #resultScreen, #traineesTable {
      display: none;
    }

    
#traineesTable {
  display: none;
  overflow-x: auto;
  max-width: 100%;
  white-space: nowrap;
}



    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: right;
    }
    th {
      background-color: #eee;
    }



/* ğŸŒŸ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
.details-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.details-content {
  background: linear-gradient(135deg, #ffffff, #f4f8ff);
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
  width: 350px;
  text-align: right;
  direction: rtl;
  position: relative;
  animation: fadeIn 0.3s ease-in-out;
}

.details-content h3 {
  color: #004aad;
  margin-bottom: 15px;
  border-bottom: 2px solid #004aad;
  padding-bottom: 5px;
}

.details-info {
  font-size: 15px;
  line-height: 1.8;
  color: #333;
}

.close-details {
  position: absolute;
  left: 10px;
  top: 5px;
  font-size: 24px;
  cursor: pointer;
  color: #444;
  transition: 0.2s;
}
.close-details:hover {
  color: red;
  transform: scale(1.1);
}

@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}



/* ğŸ” Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
#loginScreen {
  position: fixed;
  top: 0;
  right: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #004aad, #007bff);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.login-box {
  background: white;
  padding: 25px;
  border-radius: 12px;
  width: 320px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

.login-box h2 {
  margin-bottom: 15px;
  color: #004aad;
}

.login-box input {
  text-align: center;
  font-size: 18px;
}

.login-box button {
  background-color: #004aad;
  color: white;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

.login-box button:hover {
  background-color: #003080;
}

#errorMsg {
  color: red;
  margin-top: 10px;
  display: none;
}




  </style>
</head>


<!-- Modal: Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© -->
<div id="targetGroupModal" class="modal-overlay" style="display:none;">
  <div class="modal-box">
    <span class="close-modal" id="closeTargetGroup">&times;</span>
    <h2>ğŸ“‹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</h2>

   
    
    <table id="targetGroupTable" class="target-table">
      <thead>
        <tr>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th>
          <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
          <th>ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø§Ù„Ù…Ø§Ù†Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª</th>
          <th>ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙÙ†ÙŠØ© ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ù†Ù‰ Ù„Ù…ÙˆØ¸ÙÙ‰ Ø§Ù„Ù‡ÙŠØ¦Ø©</th>
          <th>ØªÙØ§ØµÙŠÙ„</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>



<!-- ğŸª„ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© -->
<div id="detailsModal" class="details-modal">
  <div class="details-content">
    <span class="close-details">&times;</span>
    <h3>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨</h3>
    <div id="detailsInfo" class="details-info"></div>
  </div>
</div>


<body>

  <!-- ğŸ” Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen">
  <div class="login-box">
    <h2>ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
    <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
    <div id="errorMsg">âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
  </div>
</div>


   <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ùˆ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <form id="container">
    <!-- Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
  </form>

  <script>
    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø©ØŒ Ø£Ø¯Ø®Ù„ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    document.addEventListener("click", () => {
      const elem = document.documentElement; // Ø£Ùˆ document.getElementById("myForm")
      if (document.fullscreenElement) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¡ Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©

      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
      }
    });
  </script>


  <div class="container">
   <style>
  h2 {
    text-align: center;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 5px 0;
    color: #004080;
  }

  h2:nth-child(4) {
    font-size: 1.8em;      /* Ø£ÙƒØ¨Ø± Ø­Ø¬Ù… Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø¹ */
    font-weight: bold;
    margin-top: 5px;
    color: #007acc;
  }
  
</style>



<div style="
  position: relative;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin-top: 10px;
  margin-bottom: 30px;
">

  <!-- âœ… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© + ÙƒÙ„Ù…Ø© DTC -->
  <div style="
    position: absolute;
    top: 10px;
    left: 25px;
    display: flex;
    flex-direction: column;
    align-items: center;
  ">

    <!-- ğŸ–¼ï¸ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„ÙƒØ¨ÙŠØ± -->
    <img src="logo.jpg" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" style="
      width: 120px; /* âœ… ØªÙ… ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ */
      height: 120px; /* âœ… ØªÙ… ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 6px 14px rgba(0,0,0,0.3);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    "
    onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.35)'"
    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 14px rgba(0,0,0,0.3)'"
    >

    <!-- ğŸŒˆ ÙƒÙ„Ù…Ø© DTC Ø£Ø³ÙÙ„ Ø§Ù„Ù„ÙˆØ¬Ùˆ -->
    <div style="
      margin-top: 8px;
      font-size: 26px; /* âœ… ØªÙ… ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· */
      font-weight: 900;
      background: linear-gradient(90deg, #ff00cc, #3333ff, #ff0000);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      user-select: none;
      letter-spacing: 1.5px;
      text-shadow: 0 0 10px rgba(255,255,255,0.3);
    ">
      DTC TANTA
    </div>

  </div>

</div>


<style>
@keyframes fadeInRight {
  0% { opacity: 0; transform: translateX(40px) scale(0.9); }
  100% { opacity: 0.95; transform: translateX(0) scale(1); }
}

@keyframes shimmer {
  0% { background-position: -400%; }
  100% { background-position: 400%; }
}
</style>




<style>
@keyframes fadeInRight {
  0% { opacity: 0; transform: translateX(40px) scale(0.9); }
  100% { opacity: 0.95; transform: translateX(0) scale(1); }
}

@keyframes shimmer {
  0% { background-position: -400%; }
  100% { background-position: 400%; }
}

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
.header-container {
  position: relative;
  background: white;
  width: fit-content; /* âœ… ÙŠØ®Ù„ÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù„Ù‰ Ù‚Ø¯ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨Ø³ */
  margin: 20px auto; /* âœ… ÙÙŠ Ø§Ù„Ù†Øµ */
  padding: 10px 30px;
  border-radius: 15px;
box-shadow: 
    0 4px 15px rgba(0, 0, 0, 0.25),   /* Ø¸Ù„ Ø£Ø³Ø§Ø³ÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
    0 8px 30px rgba(255, 215, 0, 0.3), /* Ù„Ù…Ø³Ø© Ø°Ù‡Ø¨ÙŠØ© Ù„Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
    0 0 20px rgba(255, 255, 255, 0.2); /* ØªÙˆÙ‡Ø¬ Ø®ÙÙŠÙ Ø­ÙˆÙ„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
  text-align: center;
}

.header-container h2 {
  margin: 5px 0;
}
</style>

<div class="header-container">
  <h2>ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø±Ù‰</h2>
  <h2>Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù…Ø´Ø±ÙˆØ¹Ø§Øª Ø§Ù„ØµØ±Ù</h2>

  <!-- Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¯Ø±ÙŠØ¨ + Ø§Ù„Ø´Ø¹Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
  <div style="position: relative; display: inline-block;">
    <h2 style="display: inline-block;">Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù Ø¨Ø·Ù†Ø·Ø§</h2>

    <!-- ğŸª” Ø´Ø¹Ø§Ø± Ø°Ù‡Ø¨ÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
    <div id="signature" style="
      position: absolute;
      top: 0;
      right: -280px; /* ğŸ”§ Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© */
      padding: 4px 14px;
      border: 3px solid #d4af37;
      border-radius: 40px;
      background: radial-gradient(circle at center, rgba(60, 45, 10, 0.9) 0%, rgba(0, 0, 0, 0.85) 100%);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.3), inset 0 0 8px rgba(255, 255, 200, 0.1);
      font-family: 'Papyrus', 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 900;
      color: #d4af37;
      letter-spacing: 1.5px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      background-image: linear-gradient(
        90deg,
        #b8860b 0%, #daa520 20%, #ffd700 50%, #fff8dc 75%, #ffec8b 90%, #b8860b 100%
      );
      border: 2px solid #b8860b;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 400%;
      animation: fadeInRight 2s ease-out, shimmer 25s infinite linear;
      opacity: 0.95;
      text-align: center;
    ">
      âœï¸ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©

    </div>
  </div>

  <h2>Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</h2>
  <h2>ğŸ”¹ Trainees Database Management Form</h2>
</div>




<style>


#toggleFormBtn {
  display: block;
  width: 60%;               /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù† 100% */
  margin: 15px auto;        /* ÙˆØ³Ø· Ø§Ù„ØµÙØ­Ø© Ø£ÙÙ‚ÙŠØ§Ù‹ */
  font-size: 20px;
  font-weight: bold;
  padding: 14px 28px;
  background-color: #004085;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  transition: background-color 0.3s ease;
  text-align: center;
}

#toggleFormBtn:hover {
  background-color: #002752;
}


</style>

<style>


/* ===== Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===== */
#loginScreen{
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;

  /* âŒ Ø´ÙŠÙ„ Ø£ÙŠ Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© */
  background: transparent;

  /* Ù„Ùˆ Ø­Ø§Ø¨Ø¨ ØªØ¹ØªÙŠÙ… Ø®ÙÙŠÙ Ø¬Ø¯Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
  /* background: rgba(0,0,0,0.25); */

  z-index: 9999;
}


/* ===== ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===== */
.login-box{
  width: 360px;
  max-width: 92%;
  padding: 38px 32px;
  border-radius: 18px;
  text-align: center;

  background:
    linear-gradient(145deg,#1b1f24,#0a0d11);

  border: 1px solid rgba(0,255,255,.45);

  box-shadow:
    0 0 40px rgba(0,255,255,.35),
    inset 0 0 25px rgba(0,0,0,.85);

  position: relative;
}

/* Ù„Ù…Ø³Ø© Ù†ÙŠÙˆÙ† Ø¥Ø·Ø§Ø± */
.login-box::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:20px;
  background:
    linear-gradient(120deg,#00f7ff,#005f66,#00f7ff);
  opacity:.35;
  z-index:-1;
  filter: blur(8px);
}

/* ===== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ===== */
.login-box h2{
  color:#00f7ff;
  font-size:26px;
  margin-bottom:28px;
  letter-spacing:3px;
  text-shadow:
    0 0 10px #00f7ff,
    0 0 25px rgba(0,255,255,.6);
}

/* ===== Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ===== */
#passwordInput{
  width:100%;
  padding:15px;
  font-size:16px;
  letter-spacing:2px;
  border-radius:12px;
  outline:none;

  background:#05080c;
  color:#00f7ff;

  border:1px solid rgba(0,255,255,.6);

  box-shadow:
    inset 0 0 15px rgba(0,255,255,.25);
}

#passwordInput::placeholder{
  color:rgba(0,255,255,.45);
}

/* ØªØ£Ø«ÙŠØ± ÙÙˆÙƒØ³ */
#passwordInput:focus{
  box-shadow:
    0 0 15px rgba(0,255,255,.9),
    inset 0 0 20px rgba(0,255,255,.4);
}

/* ===== Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ ===== */
.login-box button{
  margin-top:26px;
  width:100%;
  padding:15px 0;

  font-size:15px;
  font-weight:bold;
  letter-spacing:3px;

  border:none;
  border-radius:14px;
  cursor:pointer;

  background:
    linear-gradient(145deg,#00f7ff,#007c85);

  color:#000;

  box-shadow:
    0 0 20px rgba(0,255,255,.8);

  transition:.3s ease;
}

.login-box button:hover{
  transform: scale(1.05);
  box-shadow:
    0 0 35px rgba(0,255,255,1);
}

/* ===== Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ ===== */
#errorMsg{
  display:none;
  margin-top:18px;
  color:#ff4d4d;
  font-weight:bold;
  letter-spacing:1px;
  text-shadow:0 0 10px rgba(255,0,0,.6);
}
<style>


<style>
  .btn-container {
  display: flex;
  flex-wrap: wrap; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ùˆ Ø§Ù„Ø´Ø§Ø´Ø© ØµØºÙŠØ±Ø© */
  gap: 10px;       /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
  justify-content: center; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£ÙÙ‚ÙŠØ§Ù‹ */
  align-items: center;     /* Ù…Ø­Ø§Ø°Ø§Ø© Ø±Ø£Ø³ÙŠØ© */
  margin-bottom: 15px;     /* Ù…Ø³Ø§ÙØ© Ø£Ø³ÙÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
}


  .db-button:hover {
    background-color: #cce0ff;
  }
</style>

<!-- Ø­Ø§ÙˆÙŠØ© ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<!-- Ø­Ø§ÙˆÙŠØ© ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<div class="btn-container">

  <button class="btn" onclick="backupIndexedDB()">
    ğŸ”„ Backup
  </button>

  <button class="btn" onclick="document.getElementById('restoreFile').click()">
    â™»ï¸ Restore
  </button>
  <input type="file" id="restoreFile" style="display:none" onchange="restoreIndexedDB(event)" accept=".json" />

  <button class="btn" onclick="printStatsAndCharts()">
    ğŸ“Š Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡
  </button>

  <button class="btn" onclick="clearIndexedDB()">
    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  </button>

  <button class="btn" onclick="exportToExcel()">
    ğŸ“ ØªØµØ¯ÙŠØ± Excel
  </button>

  <button class="btn" onclick="toggleAllTrainees()">
    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
  </button>

  <button class="btn" id="openTargetGroupBtn">
    ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
  </button>

</div>

<style>
@media print {
  body * {
    visibility: hidden !important;
  }

  #statsInfo, #statsInfo * {
    visibility: visible !important;
    font-weight: 900 !important; /* Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø«Ù‚ÙŠÙ„ Ø¬Ø¯Ø§Ù‹ */
    color: #000 !important;
  }

  #statsInfo {
    position: absolute;
    top: 40px;
    right: 0;
    left: 0;
    margin: 0 auto;
    padding: 10px 15px;
    box-sizing: border-box;
    font-size: 16pt !important; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
  }

  #statsInfo div {
    height: auto !important;
    overflow: visible !important;
    page-break-inside: avoid;
  }

  #statsInfo::before {
    content: "Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†";
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    text-align: center;
    font-weight: 900;
    font-size: 20pt; /* ØªØµØºÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø´ÙˆÙŠ */
    color: #000;
    margin-bottom: 8px;
    border-bottom: 3px solid #000;
    padding-bottom: 6px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: white;
    z-index: 9999;
  }

  #traineesTable,
  #allTrainees,
  #searchInput {
    display: none !important;
  }
}
</style>
<div style="
  text-align: center;
  margin: 25px 0;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
  font-family: 'Cairo', sans-serif;
">

  <!-- ğŸ—“ï¸ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø¯Ø© (ÙŠÙ…ÙŠÙ†) -->
  <div style="display: flex; align-items: center; gap: 8px;">
    <input 
      type="date" 
      id="fromDate" 
      style="
        padding: 12px 15px; 
        font-size: 17px; 
        border: 2px solid #0d6efd; 
        border-radius: 10px; 
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.15);
      "
      onfocus="this.style.borderColor='#6610f2'; this.style.boxShadow='0 0 12px rgba(102,16,242,0.4)'"
      onblur="this.style.borderColor='#0d6efd'; this.style.boxShadow='0 2px 8px rgba(13,110,253,0.15)'"
    >
    <span style="font-weight: bold; font-size: 18px;">ğŸ•“ Ø¥Ù„Ù‰</span>
    <input 
      type="date" 
      id="toDate" 
      style="
        padding: 12px 15px; 
        font-size: 17px; 
        border: 2px solid #0d6efd; 
        border-radius: 10px; 
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.15);
      "
      onfocus="this.style.borderColor='#6610f2'; this.style.boxShadow='0 0 12px rgba(102,16,242,0.4)'"
      onblur="this.style.borderColor='#0d6efd'; this.style.boxShadow='0 2px 8px rgba(13,110,253,0.15)'"
    >
  </div>

  <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø´Ø§Ù…Ù„ -->
  <div style="display: flex; align-items: center;">
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¯ÙˆØ±Ø©ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ ..." 
      style="
        width: 340px; 
        padding: 13px 18px; 
        font-size: 18px; 
        border: 2px solid #0d6efd; 
        border-radius: 10px 0 0 10px; 
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.15);
      "
      onfocus="this.style.borderColor='#6610f2'; this.style.boxShadow='0 0 12px rgba(102,16,242,0.4)'"
      onblur="this.style.borderColor='#0d6efd'; this.style.boxShadow='0 2px 8px rgba(13,110,253,0.15)'"
    >

    <button 
      onclick="searchTrainees()" 
      style="
        position: relative;
        padding: 13px 25px; 
        font-size: 18px; 
        background: linear-gradient(135deg, #0d6efd, #6610f2);
        color: white; 
        border: none; 
        border-radius: 0 10px 10px 0; 
        cursor: pointer;
        font-weight: 700;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        overflow: hidden;
      "
      onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.4)'"
      onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.3)'"
    >
      <span id='searchEmoji' style='font-size:22px; animation: bounce 1.2s infinite ease-in-out;'>ğŸ”</span>
      <span>Ø¨Ø­Ø«</span>
      <span style="
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.15);
        transform: skewX(-45deg);
        animation: shine 3s infinite;
      "></span>
    </button>
  </div>
</div>

<style>
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

@keyframes shine {
  0% { left: -100%; }
  50% { left: 120%; }
  100% { left: 120%; }
}
</style>




        <style>


#registrationForm {
      font-size: 20px;
      font-weight: bold;
      direction: rtl;
    }

    #registrationForm label {
      display: block;
      margin-top: 10px;
    }

    #registrationForm input,
    #registrationForm select {
      font-size: 18px;
      font-weight: bold;
      padding: 8px;
      width: 100%;
      margin-bottom: 10px;
      box-sizing: border-box;
    }



  /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-container {
  display: flex;
  flex-wrap: nowrap;        /* Ø§Ø¬Ø¹Ù„ ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ */
  justify-content: center;
  gap: 8px;                 /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
  padding: 10px 15px;       /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø´ÙˆØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ ÙˆØ§Ù„ÙŠØ³Ø±Ù‰ */
  border-radius: 20px;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1);
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  transition: all 0.3s ease-in-out;
}


.btn-container:hover {
  transform: scale(1.02);
  box-shadow: 0 12px 35px rgba(0,0,0,0.3);
}

/* Ø£Ø²Ø±Ø§Ø± Ù…ÙˆØ­Ø¯Ø© */
.btn-container .btn {
  font-size: 18px;           /* Ø®Ø· Ø£ÙƒØ¨Ø± */
  width: 160px;              /* Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø²Ø± */
  height: 50px;              /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
  padding: 0 15px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;                  /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
  transition: transform 0.2s, box-shadow 0.2s;
  color: #fff;
  background: linear-gradient(45deg, #ff6a00, #ee0979);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
.btn-container .btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

  .btn {
    font-size: 25px;
    padding: 12px 16px;
    border: 1px solid #555;
    border-radius: 6px;
    color: #222;
    background-color: #f8f9fa;
    cursor: pointer;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 130px;
    box-shadow: none;
    font-weight: 600;
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select: none;
  }



  .btn:hover {
    background-color: #e2e6ea;
    color: #000;
  }
  .btn:active {
    background-color: #ced4da;
  }

  /* Ø£Ù„ÙˆØ§Ù† Ø±Ø³Ù…ÙŠØ© */
  .btn-submit {
    border-color: #1c3d5a;
    color: #1c3d5a;
    background-color: #dbe9f4;
  }
  .btn-submit:hover {
    background-color: #c4dbf2;
  }

  .btn-add {
    border-color: #375a7f;
    color: #375a7f;
    background-color: #d3e0eb;
  }
  .btn-add:hover {
    background-color: #bbd1e4;
  }

  .btn-clear {
    border-color: #8b1c1c;
    color: #8b1c1c;
    background-color: #f2dede;
  }
  .btn-clear:hover {
    background-color: #e4baba;
  }

  .btn-export {
    border-color: #3a5f7d;
    color: #3a5f7d;
    background-color: #d1dde6;
  }
  .btn-export:hover {
    background-color: #b9c9db;
  }

  .btn-show {
    border-color: #565656;
    color: #565656;
    background-color: #e9e9e9;
  }
  .btn-show:hover {
    background-color: #d6d6d6;
  }

  .btn svg {
    width: 28px;
    height: 28px;
    fill: currentColor;
  }
</style>





</div>


      </div>
    </form>

    <style>
  #resultScreen {
    font-size: 18px;       /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
    font-weight: bold;     /* Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø«Ù‚ÙŠÙ„ */
    direction: rtl;        /* Ù„ØªÙ†Ø§Ø³Ù‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ */
    font-family: "Arial", sans-serif;
    margin-top: 20px;
  }

  #resultScreen h3 {
    font-size: 20px;
    margin-bottom: 15px;
    color: #2c3e50;
  }

  #resultScreen table {
    width: 100%;
    border-collapse: collapse;
  }

  #resultScreen th,
  #resultScreen td {
    padding: 12px 16px;
    border: 1px solid #ccc;
    text-align: right;
    font-size: 22px;
  }

  #resultScreen th {
    background-color: #f4f6f8;
    color: #333;
  }
</style>







   <style>
  .buttons {
    display: flex;
    gap: 16px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    justify-content: center;
    margin-top: 20px;
  }

  .buttons button {
    font-size: 18px;       /* ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    font-weight: bold;     /* Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø«Ù‚ÙŠÙ„ */
    padding: 12px 20px;
    border: 1px solid #555;
    border-radius: 6px;
    background-color: #f8f9fa;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .buttons button:hover {
    background-color: #e2e6ea;
  }
</style>




   

<style>
 #traineesTable {
  background-color: rgb(255, 255, 249); /* Ø®Ù„ÙÙŠØ© Ø¨Ù„ÙˆÙ† ÙØ§ØªØ­ */
  padding: 15px;                       /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© */
  border-radius: 15px;                 /* Ø­ÙˆØ§Ù Ù…Ø¯ÙˆØ±Ø© */
  border: 5px dotted #444;             /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ù†Ù‚Ø· */
}

  /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯ÙŠÙ Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ Ù…Ø±ØªØ¨ */
  #traineesTable table {
    width: 100%;
    border-collapse: collapse;
    font-size: 18px;         /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„ÙƒØ¨ÙŠØ± */
    font-weight: bold;       /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø«Ù‚ÙŠÙ„ */
  }

  #traineesTable th, #traineesTable td {
    border: 2px solid #ccc;
    padding: 10px;
    text-align: center;
  }

  #traineesTable th {
    background-color: #e0d8c3; /* Ù„ÙˆÙ† Ù…ØºØ§ÙŠØ± Ø´ÙˆÙŠ Ù…Ù†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¬ */
  }

 #traineesTable h3 {
    text-align: center;      /* ÙŠÙˆØ³Ù‘Ø· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    font-weight: bold;       /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø«Ù‚ÙŠÙ„ */
    text-decoration: underline; /* ÙŠØ¶ÙŠÙ Ø®Ø· ØªØ­Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    margin-bottom: 15px;     /* Ù…Ø³Ø§Ø­Ø© ØªØ­Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    font-size: 28px;         /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„ÙƒØ¨ÙŠØ± */
  }





/* Modal styles */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(16, 24, 40, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal-box {
  width: 95%;
  max-width: 1100px;
  max-height: 82vh;
  overflow-y: auto;
  background: linear-gradient(180deg, #ffffff, #f5fbff);
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 10px 40px rgba(2,6,23,0.4);
  position: relative;
}
.close-modal {
  position: absolute;
  top: 12px;
  right: 16px;
  font-size: 28px;
  cursor: pointer;
  color: #444;
}
.target-table { width:100%; border-collapse: collapse; margin-top:8px; }
.target-table th {
  background: linear-gradient(90deg,#0077b6,#00b4d8); color:#fff; padding:10px; font-weight:700;
}
.target-table td { border:1px solid #e1e7ef; padding:10px; text-align:center; vertical-align:middle; }
.target-table tr:nth-child(even){ background:#f7fbff; }
.target-table tr:hover { background:#e6f9ff; }

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± */
.attended { color:#c62828; text-decoration: line-through; font-weight:800; }
.not-attended { color:#2e7d32; font-weight:800; }

/* Ø²Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
.btn-details { background:#007bff; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
.btn-details:hover { background:#0056b3; }




</style>



<div id="traineesTable">
<h3 style="
  font-weight: 900; 
  font-size: 18px; 
  color: #222; 
  display: flex; 
  align-items: center; 
  gap: 8px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;           
  padding-top: 16px;    /* Ø±ÙØ¹ Ø£ÙƒØ«Ø± */
">
  ğŸ–¨ï¸ â¬†ï¸ <span>Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø­ØµØ§Ø¡Ø§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© CTRL+p</span>
</h3>
<h3 style="margin: 0; padding-top: 2px; padding-bottom: 0;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†:</h3>
  <table id="allTrainees">
    <thead>
      <tr>
       <tr>
  <th>ğŸ•’ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th> <!-- "ğŸ“…  ÙˆØ§Ù„ÙˆÙ‚Øª" -->
<th>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</th>
<th>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
<th>ğŸ¢ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…</th>
<th>ğŸ“ Ø§Ù„Ù…Ø¤Ù‡Ù„</th>
<th>ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
<th>ğŸ¨ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</th>
<th>ğŸ“˜ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th>
<th>ğŸ“… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©</th>
<th>ğŸ“… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©</th>
<th>ğŸ§‘â€ğŸ« ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨</th>     <!-- "ğŸ§‘â€ğŸ« Ø§Ù„Ù…Ø¯Ø±Ø¨" -->
<th>ğŸ“˜ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>     <!-- "ğŸ“– Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©" -->
<th>ğŸ› ï¸ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…</th>     <!-- "ğŸ¢ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…" -->
<th>ğŸ¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</th>     <!-- "ğŸ¨ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©" (Ù…ÙƒØ±Ø±Ø© ÙÙŠ titles) -->
<th>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th>ğŸ—‘ï¸ Ø¥Ø¬Ø±Ø§Ø¡</th>

</tr>

    </thead>
    <tbody></tbody>
  </table>
</div>







  <script>
  let db;


function syncWithGoogleSheets() {
  const txCheck = db.transaction("trainees", "readonly");
  const storeCheck = txCheck.objectStore("trainees");

  const countRequest = storeCheck.count();

  countRequest.onsuccess = function () {
    const count = countRequest.result;

    // Ø¥Ø°Ø§ ÙØ§Ø¶ÙŠ â†’ lastIndex = 0
    const lastIndex = (count === 0) ? 0 : (localStorage.getItem("lastSyncedIndex") || 0);

    fetch(`https://script.google.com/macros/s/AKfycbwVeypUuiKmsDsYUcEc2jSsFBmqHe0rWhJDljM6lUg8jOODV77xJlldkNagkXw9ChKL/exec?lastIndex=${lastIndex}`)
      .then(response => response.json())
      .then(data => {
        if (!Array.isArray(data)) {
          console.error("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
          return;
        }

        if (data.length === 0) {
          console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.");
          return;
        }

        const tx = db.transaction("trainees", "readwrite");
        const store = tx.objectStore("trainees");

        data.forEach(row => {
          const newRecord = {
            datetime: row[0] || "",
            name: row[1] || "",
            phone: row[2] || "",
            email: row[3] || "",
            department: row[4] || "",
            qualification: row[5] || "",
            job: row[6] || "",
            residency: row[7] || "",
            course: row[8] || "",
            courseStart: row[9] || "",
            courseEnd: row[10] || "",
            trainerRating: row[11] || "",
            contentRating: row[12] || "",
            organizationRating: row[13] || "",
            residencyRating: row[14] || "",
            comments: row[15] || ""
          };

          store.add(newRecord);
        });

        tx.oncomplete = () => {
          console.log("âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ lastSyncedIndex ÙÙ‚Ø· Ù„Ùˆ Ù…Ø´ ØµÙØ±
          if (lastIndex !== 0) {
            const newLastIndex = parseInt(lastIndex) + data.length;
            localStorage.setItem("lastSyncedIndex", newLastIndex);
          } else {
            // Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ù†Ø­ÙØ¸ Ø¢Ø®Ø± Ø±Ù‚Ù… ÙÙŠ Google Sheet ÙƒÙ„Ù‡
            localStorage.setItem("lastSyncedIndex", data.length);
          }

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          loadDepartmentsFromEmailField();
          loadQualificationsFromDB();
          loadJobsFromDB();
          loadCoursesFromDB();
          loadLatestData();
          loadNamesFromDB();
          loadPhonesFromDB();
        };
      })
      .catch(err => {
        console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets", err);
      });
  };
}


function openDB() {
  const request = indexedDB.open("TraineeDB", 1);

  request.onupgradeneeded = function (e) {
    db = e.target.result;
    if (!db.objectStoreNames.contains("trainees")) {
      db.createObjectStore("trainees", { keyPath: "id", autoIncrement: true });
    }
  };

 request.onsuccess = function (e) {
  db = e.target.result;

  // Ø£ÙˆÙ„ Ù…Ø±Ø©: Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† Google Sheets Ø¥Ù„Ù‰ IndexedDB
  syncWithGoogleSheets();

  // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ù…Ù„ Ù…Ù† IndexedDB Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
  // Ù…ÙÙŠØ´ Ø¯Ø§Ø¹ÙŠ Ù†Ù†Ø§Ø¯ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø£Ù†Ù‡Ø§ Ù‡ØªØªÙ†Ø§Ø¯Ù‰ Ø¯Ø§Ø®Ù„ tx.oncomplete Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„
};





  request.onerror = function () {
    alert("ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  };
}




// ===== ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© =====
const targetCourses = [
  "ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø§Ù„Ù…Ø§Ù†Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª",
  "ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙÙ†ÙŠØ© ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ù†Ù‰ Ù„Ù…ÙˆØ¸ÙÙ‰ Ø§Ù„Ù‡ÙŠØ¦Ø©"
];

const targetGroup = [
  { name: "Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø´Ø§Ù‡ÙŠÙ† Ø¹Ù…Ø§Ø±Ù‡", department: "ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§", job: "Ù…Ø´Ø±Ù" },
  { name: "Ø£Ù…Ù„ Ù…Ø­Ù…Ø¯ Ø­Ù„Ù…ÙŠ Ø£Ù…ÙŠÙ†", department: "ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§", job: "Ù…Ù‡Ù†Ø¯Ø³Ø©" },
  { name: "   Ù†Ù‡Ù‰ Ø·Ù‡ ØªÙˆÙÙŠÙ‚", department: "ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§", job: "Ù…Ø­Ø§Ø³Ø¨Ø©" },

];




function getAllTraineesFromDB() {
  return new Promise((resolve, reject) => {
    if (!db) {
      console.error("Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙØªÙˆØ­Ø© Ø¨Ø¹Ø¯.");
      reject("DB not open");
      return;
    }
    const tx = db.transaction("trainees", "readonly");
    const store = tx.objectStore("trainees");
    const all = [];

    const cursorReq = store.openCursor();
    cursorReq.onsuccess = (event) => {
      const cursor = event.target.result;
      if (cursor) {
        all.push(cursor.value);
        cursor.continue();
      } else {
        resolve(all);
      }
    };
    cursorReq.onerror = (err) => reject(err);
  });
}


// Ø¯Ø§Ù„Ø© Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Øµ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (ØªØ­Ø°Ù Ø§Ù„Ù…Ø³Ø§ÙØ§ØªØŒ ÙˆØªØ­ÙˆÙ‘Ù„ Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„ØµØºÙŠØ±Ø©/Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŒ ÙˆØªØ²ÙŠÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„)
function normalizeText(str) {
  if (!str) return "";
  return str
    .toString()
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '')        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
    .replace(/[Ø£Ø¥Ø¢Ø§]/g, 'Ø§')     // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù‡Ù…Ø²Ø§Øª
    .replace(/[Ù‰]/g, 'ÙŠ')        // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ù„Ù Ø§Ù„Ù…Ù‚ØµÙˆØ±Ø©
    .replace(/[Ø©]/g, 'Ù‡');       // ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªØ§Ø¡ Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø©
}


// ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© ÙÙŠ Ø§Ù„Ù€ Modal
async function loadTargetGroup(filterText = "") {
  const tbody = document.querySelector("#targetGroupTable tbody");
  tbody.innerHTML = "";

  let allTrainees = [];
  try {
    allTrainees = await getAllTraineesFromDB();
  } catch (e) {
    console.error("Ø®Ø·Ø£ Ø¨Ø¬Ù„Ø¨ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†:", e);
  }

  if (!allTrainees.length) {
    tbody.innerHTML = `<tr><td colspan="6">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr>`;
    return;
  }

  targetGroup.forEach(person => {
    if (filterText && !person.name.includes(filterText)) return;

    // Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø· (Ù…Ø¹ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©)
    const personName = (person.name || "").replace(/\s+/g, '').trim();

    const records = allTrainees.filter(t => {
  return normalizeText(t.name) === normalizeText(person.name);
});

const attended = {};
targetCourses.forEach(c => {
  attended[c] = records.some(r => normalizeText(r.course) === normalizeText(c));
});


    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${person.name}</td>
      <td>${person.department || ""}</td>
      <td>${person.job || ""}</td>
      <td class="${attended[targetCourses[0]] ? 'attended' : 'not-attended'}">${attended[targetCourses[0]] ? '<s>'+targetCourses[0]+'</s>' : targetCourses[0]}</td>
      <td class="${attended[targetCourses[1]] ? 'attended' : 'not-attended'}">${attended[targetCourses[1]] ? '<s>'+targetCourses[1]+'</s>' : targetCourses[1]}</td>
      <td><button class="btn-details" onclick="showDetails('${person.name.replace(/'/g,"\\'")}')">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button></td>
    `;
    tbody.appendChild(tr);
  });
}



async function showDetails(name) {
  const all = await getAllTraineesFromDB();
  const record = all.find(t => (t.name || "").replace(/\s+/g, '') === name.replace(/\s+/g, ''));

  if (!record) {
    alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
    return;
  }

  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
  const infoHTML = `
    <p><strong>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:</strong> ${record.name || "â€”"}</p>
    <p><strong>ğŸ¢ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong> ${record.department || "â€”"}</p>
    <p><strong>ğŸ“ Ø§Ù„Ù…Ø¤Ù‡Ù„:</strong> ${record.qualification || "â€”"}</p>
    <p><strong>ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©:</strong> ${record.job || "â€”"}</p>
    <p><strong>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${record.phone || record.mobile || "â€”"}</p>
  `;

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
  const modal = document.getElementById("detailsModal");
  const infoBox = document.getElementById("detailsInfo");
  infoBox.innerHTML = infoHTML;
  modal.style.display = "flex";

  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ã— Ø£Ùˆ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø±Ø¨Ø¹
  document.querySelector(".close-details").onclick = () => modal.style.display = "none";
  window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };
}


// ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) ÙˆØ§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.getElementById("openTargetGroupBtn").addEventListener("click", () => {
  document.getElementById("targetGroupModal").style.display = "flex";
  loadTargetGroup();
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Modal
document.getElementById("closeTargetGroup").addEventListener("click", () => {
  document.getElementById("targetGroupModal").style.display = "none";
});

// Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
window.addEventListener("click", (e) => {
  const modal = document.getElementById("targetGroupModal");
  if (e.target === modal) modal.style.display = "none";
});




function loadDepartmentsFromEmailField() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const departments = new Set();

    allRecords.forEach(record => {
      if (record.email && record.email.trim() !== "") {
        departments.add(record.email.trim());
      }
    });

    const datalist = document.getElementById("departments");
    datalist.innerHTML = "";

    departments.forEach(dep => {
      const option = document.createElement("option");
      option.value = dep;
      datalist.appendChild(option);
    });
  };
}

function loadQualificationsFromDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const qualifications = new Set();

    allRecords.forEach(record => {
      if (record.qualification && record.qualification.trim() !== "") {
        qualifications.add(record.qualification.trim());
      }
    });

    const datalist = document.getElementById("qualifications");
    datalist.innerHTML = "";

    qualifications.forEach(q => {
      const option = document.createElement("option");
      option.value = q;
      datalist.appendChild(option);
    });
  };
}

function loadJobsFromDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const jobs = new Set();

    allRecords.forEach(record => {
      if (record.job && record.job.trim() !== "") {
        jobs.add(record.job.trim());
      }
    });

    const datalist = document.getElementById("jobs");
    datalist.innerHTML = "";

    jobs.forEach(job => {
      const option = document.createElement("option");
      option.value = job;
      datalist.appendChild(option);
    });
  };
}



function loadCoursesFromDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const courses = new Set();

    allRecords.forEach(record => {
      if (record.course && record.course.trim() !== "") {
        courses.add(record.course.trim());
      }
    });

    const datalist = document.getElementById("courses");
    datalist.innerHTML = "";

    courses.forEach(course => {
      const option = document.createElement("option");
      option.value = course;
      datalist.appendChild(option);
    });
  };
}


function loadNamesFromDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const names = new Set();

    allRecords.forEach(record => {
      if (record.name && record.name.trim() !== "") {
        names.add(record.name.trim());
      }
    });

    const datalist = document.getElementById("names");
    datalist.innerHTML = "";

    names.forEach(name => {
      const option = document.createElement("option");
      option.value = name;
      datalist.appendChild(option);
    });
  };
}


function loadPhonesFromDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const request = store.getAll();

  request.onsuccess = function () {
    const allRecords = request.result;
    const phones = new Set();

    allRecords.forEach(record => {
      if (record.phone && record.phone.trim() !== "") {
        phones.add(record.phone.trim());
      }
    });

    const datalist = document.getElementById("phones");
    datalist.innerHTML = "";

    phones.forEach(phone => {
      const option = document.createElement("option");
      option.value = phone;
      datalist.appendChild(option);
    });
  };
}




  function submitForm() {
    const now = new Date();
    const datetime = now.toLocaleString('ar-EG', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });

    const data = {
      name: document.getElementById("name").value,
      phone: document.getElementById("phone").value,
      email: document.getElementById("email").value,
      qualification: document.getElementById("qualification").value,
      job: document.getElementById("job").value,
      course: document.getElementById("course").value,
      duration: document.getElementById("duration").value,
      type: document.getElementById("type").value,
      datetime: datetime
    };

    document.getElementById("actionButtons").style.display = "flex";


    const tx = db.transaction("trainees", "readwrite");
    const store = tx.objectStore("trainees");
    const req = store.add(data);

    req.onsuccess = () => showData(data);
    req.onerror = () => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
  }

 function showData(data) {
  document.getElementById("resName").innerText = data.name || "";
  document.getElementById("resPhone").innerText = data.phone || "";
  document.getElementById("resDepartment").innerText = data.department || "";
  document.getElementById("resQualification").innerText = data.qualification || "";
  document.getElementById("resJob").innerText = data.job || "";
  document.getElementById("resCourse").innerText = data.course || "";
  document.getElementById("resDuration").innerText = (data.courseStart || "") + " Ø¥Ù„Ù‰ " + (data.courseEnd || "");
  document.getElementById("resType").innerText = data.residency || "";
  document.getElementById("resDatetime").innerText = data.datetime || "";

  // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
  document.getElementById("resTrainerRating").innerText = data.trainerRating || "";
  document.getElementById("resContentRating").innerText = data.contentRating || "";
  document.getElementById("resOrganizationRating").innerText = data.organizationRating || "";
  document.getElementById("resResidencyRating").innerText = data.residencyRating || "";
  document.getElementById("resComments").innerText = data.comments || "";

  // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  document.getElementById("registrationForm").style.display = "none";
  document.getElementById("resultScreen").style.display = "block";
}




  function loadLatestData() {
    const tx = db.transaction("trainees", "readonly");
    const store = tx.objectStore("trainees");
    const req = store.openCursor(null, 'prev');

    req.onsuccess = e => {
      const cursor = e.target.result;
      if (cursor) {
        const d = cursor.value;
        document.getElementById("name").value = d.name;
        document.getElementById("phone").value = d.phone;
        document.getElementById("email").value = d.email;
        document.getElementById("qualification").value = d.qualification;
        document.getElementById("job").value = d.job;
        document.getElementById("course").value = d.course;
        document.getElementById("duration").value = d.duration;
        document.getElementById("type").value = d.type;
      }
    }
  }

  function exportToExcel() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");

  const headers = [
    "ğŸ•’ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…",
    "ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ",
    "ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    "ğŸ¢ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
    "ğŸ“ Ø§Ù„Ù…Ø¤Ù‡Ù„",
    "ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©",
    "ğŸ¨ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©",
    "ğŸ“˜ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©",
    "ğŸ“… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©",
    "ğŸ“… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø©",
    "ğŸ§‘â€ğŸ« ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨",
    "ğŸ“˜ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰",
    "ğŸ› ï¸ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…",
    "ğŸ¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©",
    "ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"
  ];

  const rows = [headers];
  const allData = [];

  // ğŸ§¹ Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
  function normalizeArabic(text) {
    if (!text) return "";
    return String(text)
      .replace(/[Ø£Ø¥Ø¢Ø§]/g, "Ø§")
      .replace(/Ù‰/g, "ÙŠ")
      .replace(/Ø¤/g, "Ùˆ")
      .replace(/Ø¦/g, "ÙŠ")
      .replace(/Ø©/g, "Ù‡")
      .toLowerCase();
  }

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      const d = cursor.value;

      // ğŸ‘‡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
     // ğŸ‘‡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
if (d.department) {
  const originalDept = d.department.trim();
  const deptNorm = normalizeArabic(originalDept);
  let detectedRegion = "";

  const regionKeywords = {
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§": ["Ø·Ù†Ø·Ø§","ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","Ø§Ù„ØºØ±Ø¨ÙŠØ©","Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©","Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©","Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø²ÙØªÙ‰","ÙƒÙØ± Ø§Ù„Ø²ÙŠØ§Øª","ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§","Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù","Ù…ØµÙ†Ø¹ Ù…ÙˆØ§Ø³ÙŠØ± Ø²ÙØªÙ‰"],
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§": ["ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§","ØºØ±Ø¨ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù†ÙˆØ¨Ø§Ø±ÙŠØ©","Ø¯Ù…Ù†Ù‡ÙˆØ±","Ù…Ø´Ø±ÙˆØ¹Ø§Øª ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§"],
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§": ["Ø¯Ù…ÙŠØ§Ø·","Ø¨Ø·Ù„Ø®Ø§","ÙØ§Ù‚ÙˆØ³","Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚","Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©","Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©","Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§","ØµØ±Ù Ø¯Ù…ÙŠØ§Ø· Ø¨Ø·Ù„Ø®Ø§","Ø§Ø¯Ø§Ø±Ø© Ø¯Ù…ÙŠØ§Ø· Ø¨Ø·Ù„Ø®Ø§"],
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡": ["Ø§Ù„Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯","Ø§Ù„Ø³ÙˆÙŠØ³","Ø³ÙŠÙ†Ø§Ø¡","Ø§Ù„Ù‚Ù†Ø·Ø±Ø©","Ø§Ù„ØªÙ„ Ø§Ù„ÙƒØ¨ÙŠØ±","ÙØ§ÙŠØ¯","Ø§Ù„Ù‚Ù†Ø§Ø©"],
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§": ["Ø§Ø³ÙˆØ§Ù†","Ø³ÙˆÙ‡Ø§Ø¬","Ø§Ø³ÙŠÙˆØ·","Ø§Ù„ÙˆØ§Ø¯Ù‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯","Ø´Ù…Ø§Ù„ Ù‚Ù†Ø§","Ø¬Ù†ÙˆØ¨ Ù‚Ù†Ø§","ÙƒÙˆÙ… Ø§Ù…Ø¨Ùˆ","Ù…Ø´Ø±ÙˆØ¹Ø§Øª ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ù‚Ù†Ø§ Ø¨Ø§Ø³Ù†Ø§"],
    "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰": ["Ø¬Ù†ÙˆØ¨ Ø§Ù„ÙÙŠÙˆÙ…","Ø¨Ù†Ù‰ Ø³ÙˆÙŠÙ","Ø´Ù…Ø§Ù„ Ø§Ù„Ø¬ÙŠØ²Ø©","ØºØ±Ø¨ Ø§Ù„ÙÙŠÙˆÙ…","Ø´Ø±Ù‚ Ø§Ù„ÙÙŠÙˆÙ…","Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¬ÙŠØ²Ø©"]
  };

  // ğŸ§­ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
  for (const [region, keywords] of Object.entries(regionKeywords)) {
    for (const kw of keywords) {
      const kwNorm = normalizeArabic(kw);
      if (deptNorm.includes(kwNorm)) {
        detectedRegion = region;
        break;
      }
    }
    if (detectedRegion) break;
  }

  // âœ… Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø· Ø®Ø§Øµ Ø¨Ø§Ù„Ù‡ÙŠØ¦Ø©
  if (!detectedRegion && (deptNorm.includes("Ù‡ÙŠØ¦Ù‡") || deptNorm.includes("Ù‡ÙŠØ¦Ø©"))) {
    detectedRegion = "Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ù„Ù‡ÙŠØ¦Ø©";
  }

  if (!detectedRegion) {
    if (deptNorm.includes("Ù…ØµÙ†Ø¹ Ù…ÙˆØ§Ø³ÙŠØ±") || deptNorm.includes("Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù")) {
      detectedRegion = "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§";
    }
  }

  // ğŸ·ï¸ Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  d.department = detectedRegion ? `${originalDept} - ${detectedRegion}` : originalDept;
}

      // ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙˆÙ
      allData.push([
        d.datetime || "",
        d.name || "",
        d.phone || "",
        d.email || "",
        d.department || "",
        d.qualification || "",
        d.job || "",
        d.residency || "",
        d.course || "",
        d.courseStart || "",
        d.courseEnd || "",
        d.trainerRating || "",
        d.contentRating || "",
        d.organizationRating || "",
        d.residencyRating || "",
        d.comments || ""
      ]);

      cursor.continue();
    } else {
      const data = [...rows, ...allData];
      const ws = XLSX.utils.aoa_to_sheet(data);

      // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯
      const headerStyle = {
        font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "4F81BD" } },
        alignment: { horizontal: "center", vertical: "center" },
        border: {
          top: { style: "thin", color: { auto: 1 } },
          bottom: { style: "thin", color: { auto: 1 } },
          left: { style: "thin", color: { auto: 1 } },
          right: { style: "thin", color: { auto: 1 } }
        }
      };

      const dataStyle = {
        font: { sz: 16 },
        alignment: { vertical: "center", wrapText: true },
        border: {
          top: { style: "thin", color: { auto: 1 } },
          bottom: { style: "thin", color: { auto: 1 } },
          left: { style: "thin", color: { auto: 1 } },
          right: { style: "thin", color: { auto: 1 } }
        }
      };

      const range = XLSX.utils.decode_range(ws["!ref"]);
      for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
          const cell_address = { c: C, r: R };
          const cell_ref = XLSX.utils.encode_cell(cell_address);
          if (!ws[cell_ref]) continue;
          ws[cell_ref].s = (R === 0) ? headerStyle : dataStyle;
        }
      }

      // Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      const colWidths = data[0].map((col, i) => {
        let maxLen = col.length;
        allData.forEach(row => {
          if (row[i] && row[i].length > maxLen) maxLen = row[i].length;
        });
        return { wch: Math.min(Math.max(maxLen + 4, 12), 40) };
      });
      ws['!cols'] = colWidths;

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†");
      XLSX.writeFile(wb, "trainees.xlsx");
    }
  };

  store.openCursor().onerror = function(e) {
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±.");
  };
}


  function clearIndexedDB() {
  // ÙØªØ­ Ù†Ø§ÙØ°Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  document.getElementById("passwordModal").style.display = "flex";
}

function confirmPassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === "1550") {
    const tx = db.transaction("trainees", "readwrite");
    tx.objectStore("trainees").clear().onsuccess = () => {
      alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
      location.reload();
    };
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
  }
  closePasswordModal();
}

function closePasswordModal() {
  document.getElementById("passwordModal").style.display = "none";
  document.getElementById("passwordInput").value = "";
}


  function toggleAllTrainees() {
  const traineesTable = document.getElementById("traineesTable");


  // âœ³ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
const rows = traineesTable.querySelectorAll("tbody tr");
rows.forEach(row => {
  const deptCell = row.cells[4]; // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø§Ø¯Ø© Ù‡Ùˆ Ø¹Ù…ÙˆØ¯ "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"
  if (deptCell && deptCell.textContent.trim()) {
    const deptName = deptCell.textContent.trim();
    if (regionsMap[deptName]) {
      deptCell.textContent = `${deptName} - ${regionsMap[deptName]}`;
    }
  }
});


  // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = traineesTable.innerHTML;

  // Ø­Ø°Ù ÙƒÙ„ Ø¹Ù†Ø§ÙˆÙŠÙ† h3 Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
  const h3s = tempDiv.querySelectorAll('h3');
  h3s.forEach(h3 => h3.remove());

  const tableHtml = tempDiv.innerHTML;

  // Ù‡Ù†Ø§ Ù†Ø¬ÙŠØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
  const statsBoxes = document.getElementById("statsBoxes");
  const statsHtml = statsBoxes ? statsBoxes.innerHTML : '';

  const printWindow = window.open('', '', 'width=900,height=600');

  const currentDate = new Date().toLocaleDateString('ar-EG', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  printWindow.document.write(`
    <html>
      <head>
        <title>Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</title>
        <style>
          body {
            font-family: 'Arial', sans-serif;
            direction: rtl;
            padding: 20px;
            background-color: #fff;
            color: #000;
          }
          header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
          }
          .logo-container {
            text-align: center;
          }
          .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: block;
            margin: 0 auto;
          }
          .logo-caption {
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
          }
          .header-info {
            flex-grow: 1;
            margin-right: 20px;
            text-align: center;
          }
          .center-title {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0 5px 0;
            border-bottom: 2px solid #000;
            display: inline-block;
            padding-bottom: 5px;
          }
          .date {
            font-size: 14px;
            color: #333;
            text-align: left;
            margin-top: 10px;
          }
          /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
          #statsBoxes {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            justify-content: center;
          }
          .stat-box {
            border: 2px solid #4F81BD;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 16px;
            background-color: #e7f0ff;
            color: #2a4d8f;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          }
          table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
          }
          th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
          }
          th {
            background-color: #f2f2f2;
          }
          button {
            display: none;
          }
          .signature {
            text-align: left;
            margin-top: 50px;
            font-family: 'Brush Script MT', cursive;
            font-size: 24px;
            color: #444;
            padding-left: 40px;
          }
        </style>
      </head>
      <body>
        <header>
          <div class="logo-container">
            <img src="logo.jpg" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" class="logo">
            <div class="logo-caption">Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù Ø¨Ø·Ù†Ø·Ø§</div>
          </div>
          <div class="header-info">
            <div class="center-title">Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</div>
          </div>
          <div class="date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${currentDate}</div>
        </header>

        <div id="statsBoxes">${statsHtml}</div>

        <div id="traineesTable">${tableHtml}</div>

      </body>
    </html>
  `);

  printWindow.document.close();
  printWindow.focus();

  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 300);
}




function deleteRecord(id) {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ")) {
    const tx = db.transaction("trainees", "readwrite");
    const store = tx.objectStore("trainees");
    store.delete(id).onsuccess = () => {
      alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„.");
      searchTrainees() ;


    };
  }
}


function addNewTrainee() {
  document.getElementById("registrationForm").style.display = "block";
  document.getElementById("resultScreen").style.display = "none";
  document.getElementById("traineesTable").style.display = "none";
  document.getElementById("actionButtons").style.display = "none";

  // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¢Ø®Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©
  document.getElementById("name").value = document.getElementById("resName").textContent;
  document.getElementById("phone").value = document.getElementById("resPhone").textContent;
  document.getElementById("email").value = document.getElementById("resEmail").textContent;
  document.getElementById("qualification").value = document.getElementById("resQualification").textContent;
  document.getElementById("job").value = document.getElementById("resJob").textContent;
  document.getElementById("course").value = document.getElementById("resCourse").textContent;
  document.getElementById("duration").value = document.getElementById("resDuration").textContent;
  document.getElementById("type").value = document.getElementById("resType").textContent;
}



// âœ… Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ù‚ÙŠÙ…/Ø© ÙˆØ¥Ø¶Ø§ÙØ© ÙÙ„ØªØ±Ø© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø«
let showResults = false;

function extractDateRangeFromText(text) {
  const monthNames = {
    "ÙŠÙ†Ø§ÙŠØ±": 0, "ÙØ¨Ø±Ø§ÙŠØ±": 1, "Ù…Ø§Ø±Ø³": 2, "Ø£Ø¨Ø±ÙŠÙ„": 3, "Ø§Ø¨Ø±ÙŠÙ„": 3,
    "Ù…Ø§ÙŠÙˆ": 4, "ÙŠÙˆÙ†ÙŠÙˆ": 5, "ÙŠÙˆÙ„ÙŠÙˆ": 6, "Ø£ØºØ³Ø·Ø³": 7, "Ø§ØºØ³Ø·Ø³": 7,
    "Ø³Ø¨ØªÙ…Ø¨Ø±": 8, "Ø£ÙƒØªÙˆØ¨Ø±": 9, "Ø§ÙƒØªÙˆØ¨Ø±": 9,
    "Ù†ÙˆÙÙ…Ø¨Ø±": 10, "Ø¯ÙŠØ³Ù…Ø¨Ø±": 11
  };

  // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ
  text = text.replace(/Ø§Ù„Ù‰|Ø¥Ù„Ù‰/g, "Ø§Ù„Ù‰")
             .replace(/Ø§ÙƒØªÙˆØ¨Ø±/g, "Ø£ÙƒØªÙˆØ¨Ø±")
             .replace(/Ø§Ø¨Ø±ÙŠÙ„/g, "Ø£Ø¨Ø±ÙŠÙ„")
             .replace(/ +/g, " ").trim()
             .replace(/([^\s])Ø§Ù„Ù‰/, "$1 Ø§Ù„Ù‰")
             .replace(/Ø´Ù‡Ø±ÙŠÙ†/g, "2 Ø´Ù‡Ø±");

  // Ù†Ù…Ø·: Ù…Ù† ÙŠÙˆÙ†ÙŠÙˆ 2025 Ù„Ù…Ø¯Ø© 2 Ø´Ù‡Ø±
  const altMatch = text.match(/Ù…Ù†\s+(\w+)\s+(\d{4})\s+Ù„Ù…Ø¯Ø©\s+(\d+)/);
  if (altMatch) {
    const monthName = altMatch[1];
    const year = parseInt(altMatch[2]);
    const duration = parseInt(altMatch[3]);
    const fromMonth = monthNames[monthName];
    if (!isNaN(fromMonth)) {
      return {
        from: new Date(year, fromMonth, 1),
        to: new Date(year, fromMonth + duration, 0)
      };
    }
  }

  // Ù†Ù…Ø·: Ù…Ù† ÙŠÙˆÙ†ÙŠÙˆ Ø§Ù„Ù‰ Ø£ØºØ³Ø·Ø³ 2025
  const match = text.match(/Ù…Ù†\s+(\w+)\s+Ø§Ù„Ù‰\s+(\w+)\s+(\d{4})/);
  if (match) {
    const fromMonth = monthNames[match[1]];
    const toMonth = monthNames[match[2]];
    const year = parseInt(match[3]);
    if (!isNaN(fromMonth) && !isNaN(toMonth)) {
      return {
        from: new Date(year, fromMonth, 1),
        to: new Date(year, toMonth + 1, 0)
      };
    }
  }

  return null;
}




// ğŸ—‚ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ…
const regionsMap = {
  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ù…Ø·Ø±ÙˆØ­": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§",

  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ØºØ±Ø¨ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ø±Ù‚ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ØºØ±Ø¨ Ø·Ù†Ø·Ø§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ø±Ù‚ Ø·Ù†Ø·Ø§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„ØºØ±Ø¨ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„ØºØ±Ø¨ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§",

  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø´Ø±Ù‚ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§",

  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø§Ù„Ø³ÙˆÙŠØ³": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡",

  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ù†ÙŠØ§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ù†ÙŠØ§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø£Ø³ÙŠÙˆØ·": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø£Ø³ÙŠÙˆØ·": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø§Ù„ÙÙŠÙˆÙ…": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø§Ù„ÙÙŠÙˆÙ…": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰",

  // ğŸ”¹ Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ø³ÙˆÙ‡Ø§Ø¬": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ø³ÙˆÙ‡Ø§Ø¬": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø´Ù…Ø§Ù„ Ù‚Ù†Ø§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø¬Ù†ÙˆØ¨ Ù‚Ù†Ø§": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø§Ù„Ø£Ù‚ØµØ±": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø£Ø³ÙˆØ§Ù†": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§",
  "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØµØ±Ù Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯": "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§"
};

// âš™ï¸ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø²Ø¦ÙŠ
function getRegion(inputName) {
  if (!inputName || typeof inputName !== "string") return "Ø§Ù„Ù‡ÙŠØ¦Ø©";

  inputName = inputName.trim();

  // 1ï¸âƒ£ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ø£ÙˆÙ„Ù‹Ø§
  if (regionsMap[inputName]) {
    return regionsMap[inputName];
  }

  // 2ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ø²Ø¦ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù…Ø¹ ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø­Ø³Ø¨ Ø§Ù„Ø·ÙˆÙ„ (Ø§Ù„Ø£Ø·ÙˆÙ„ Ø£ÙˆÙ„Ù‹Ø§)
  const sortedKeys = Object.keys(regionsMap).sort((a,b) => b.length - a.length);
  const found = sortedKeys.find(key => inputName.includes(key) || key.includes(inputName));

  if (found) {
    return regionsMap[found];
  }

  // 3ï¸âƒ£ Ù„Ùˆ Ù…ÙÙŠØ´ ØªØ·Ø§Ø¨Ù‚ Ù†Ù‡Ø§Ø¦ÙŠ â†’ Ø§Ù„Ù‡ÙŠØ¦Ø©
  return "Ø§Ù„Ù‡ÙŠØ¦Ø©";
}



function searchTrainees() {

console.log("Ø¬Ø§Ø±Ù ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«...");
  
  // âœ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¨Ø­Ø«
  const signature = document.getElementById("signature");
  if (signature) {
    signature.style.opacity = "0";
    setTimeout(() => signature.style.display = "none", 1000);
  }

 const query = document.getElementById('searchInput').value.trim().toLowerCase();
  const range = extractDateRangeFromText(query);

  // ğŸ” Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø¯Ø© Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙÙŠ Ø­Ø§Ù„Ø© Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
const fromInput = document.getElementById("fromDate") ? document.getElementById("fromDate").value : "";
const toInput = document.getElementById("toDate") ? document.getElementById("toDate").value : "";

let fromDate = fromInput ? new Date(fromInput) : (range ? range.from : null);
let toDate = toInput ? new Date(toInput) : (range ? range.to : null);

if (fromDate && toDate && fromDate > toDate) {
  alert("âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©");
  return;
}


  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡ÙˆØ± Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø¯Ø§Ø®Ù„ query
const arabicToEnglishMonths = {
  "ÙŠÙ†Ø§ÙŠØ±": "january", "ÙØ¨Ø±Ø§ÙŠØ±": "february", "Ù…Ø§Ø±Ø³": "march", "Ø£Ø¨Ø±ÙŠÙ„": "april", "Ø§Ø¨Ø±ÙŠÙ„": "april",
  "Ù…Ø§ÙŠÙˆ": "may", "ÙŠÙˆÙ†ÙŠÙˆ": "june", "ÙŠÙˆÙ„ÙŠÙˆ": "july", "Ø£ØºØ³Ø·Ø³": "august", "Ø§ØºØ³Ø·Ø³": "august",
  "Ø³Ø¨ØªÙ…Ø¨Ø±": "september", "Ø£ÙƒØªÙˆØ¨Ø±": "october", "Ø§ÙƒØªÙˆØ¨Ø±": "october",
  "Ù†ÙˆÙÙ…Ø¨Ø±": "november", "Ø¯ÙŠØ³Ù…Ø¨Ø±": "december"
};

let queryNormalized = query;
for (const [ar, en] of Object.entries(arabicToEnglishMonths)) {
  queryNormalized = queryNormalized.replace(new RegExp(ar, 'gi'), en);
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ù…Ù† queryNormalized
const monthNames = {
  "january": 0, "february": 1, "march": 2, "april": 3,
  "may": 4, "june": 5, "july": 6, "august": 7,
  "september": 8, "october": 9, "november": 10, "december": 11
};

const monthYearMatch = queryNormalized.match(/(january|february|march|april|may|june|july|august|september|october|november|december)\s+(\d{4})/);
let searchMonth = null, searchYear = null;

if (monthYearMatch) {
  const monthName = monthYearMatch[1];
  const year = parseInt(monthYearMatch[2]);
  if (monthNames.hasOwnProperty(monthName)) {
    searchMonth = monthNames[monthName];
    searchYear = year;
  }
}


  const tbody = document.querySelector("#allTrainees tbody");
  const tableContainer = document.getElementById("traineesTable");

  if (!showResults) {
    tbody.innerHTML = "";
    showResults = true;
  } else {
    tbody.innerHTML = "";
    tableContainer.style.display = 'none';
    const oldStats = document.getElementById("statsInfo");
    if (oldStats) oldStats.remove();
    showResults = false;
    return;
  }

  let count = 0;
  const stats = {
    byYear: {},
    byCourseDate: {},
    byMonthYear: {},
    byDepartment: {},
    byJob: {},
    byResidencyGender: {}
  };

  // ğŸ§© Ø¯Ø§Ù„Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡Ù…Ø²Ø§Øª ÙˆØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨Ù‰
  function normalizeArabic(text) {
    if (!text) return "";
    return String(text)
      .replace(/[Ø£Ø¥Ø¢Ø§]/g, "Ø§")   // ØªÙˆØ­ÙŠØ¯ Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ø£Ù„Ù
      .replace(/Ù‰/g, "ÙŠ")        // Ø§Ù„Ø£Ù„Ù Ø§Ù„Ù…Ù‚ØµÙˆØ±Ø©
      .replace(/Ø¤/g, "Ùˆ")        // Ù‡Ù…Ø²Ø© Ø¹Ù„Ù‰ ÙˆØ§Ùˆ
      .replace(/Ø¦/g, "ÙŠ")        // Ù‡Ù…Ø²Ø© Ø¹Ù„Ù‰ ÙŠØ§Ø¡
      .replace(/Ø©/g, "Ù‡")        // Ø§Ù„ØªØ§Ø¡ Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© Ù„Ù‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      .toLowerCase();
  }

  // Ù‡Ø±ÙˆØ¨ Ù…Ø­Ø§Ø±Ù Ø§Ù„Ø±ÙŠØ¬ÙƒØ³ Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¢Ù…Ù†
  function escapeRegex(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const allRecords = [];

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      allRecords.push({ key: cursor.key, value: cursor.value });
      cursor.continue();
    } else {
      allRecords.sort((a, b) => new Date(b.value.datetime) - new Date(a.value.datetime));

      const oldStats = document.getElementById("statsInfo");
      if (oldStats) oldStats.remove();

      allRecords.forEach(({ key, value: d }) => {

if (d.department) {
  const originalDept = d.department.trim();
  const deptNorm = normalizeArabic(originalDept);
  let detectedRegion = "";

  // ğŸ§® Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ´Ø§Ø¨Ù‡ (Levenshtein)
  function levenshteinDistance(a, b) {
    const matrix = Array.from({ length: a.length + 1 }, (_, i) =>
      Array.from({ length: b.length + 1 }, (_, j) => (i === 0 ? j : j === 0 ? i : 0))
    );
    for (let i = 1; i <= a.length; i++) {
      for (let j = 1; j <= b.length; j++) {
        const cost = a[i - 1] === b[j - 1] ? 0 : 1;
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j - 1] + cost
        );
      }
    }
    return matrix[a.length][b.length];
  }

  function similarity(a, b) {
    const dist = levenshteinDistance(a, b);
    const maxLen = Math.max(a.length, b.length);
    return 1 - dist / maxLen;
  }

  // ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©// ğŸ—‚ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ø£Ù‚Ø§Ù„ÙŠÙ…
const regionKeywords = {
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§": [
    "ØºØ±Ø¨ Ø§Ù„Ø¯Ù„ØªØ§", "ØºØ±Ø¨ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", "Ø´Ø±Ù‚ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", "ÙˆØ³Ø· Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ù…Ø·Ø±ÙˆØ­"
  ],
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§": [
    "Ø·Ù†Ø·Ø§", "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®", "Ø§Ù„ØºØ±Ø¨ÙŠØ©", "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©", "Ø²ÙØªÙ‰", "ÙƒÙØ± Ø§Ù„Ø²ÙŠØ§Øª", "ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§"
  ],
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§": [
    "Ø´Ù…Ø§Ù„ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "ÙˆØ³Ø· Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", "Ø¯Ù…ÙŠØ§Ø·", "Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚", "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©", "Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©", "Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§"
  ],
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ³ÙŠÙ†Ø§Ø¡": [
    "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©", "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", "Ø§Ù„Ø³ÙˆÙŠØ³", "Ø³ÙŠÙ†Ø§Ø¡", "Ø§Ù„Ù‚Ù†Ø·Ø±Ø©", "ÙØ§ÙŠØ¯", "Ø§Ù„Ù‚Ù†Ø§Ø©"
  ],
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰": [
    "Ø§Ù„Ù…Ù†ÙŠØ§", "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", "Ø§Ù„ÙÙŠÙˆÙ…", "Ø£Ø³ÙŠÙˆØ·", "Ø§Ù„Ø¬ÙŠØ²Ø©", "Ù…ØµØ± Ø§Ù„ÙˆØ³Ø·Ù‰"
  ],
  "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§": [
    "Ø³ÙˆÙ‡Ø§Ø¬", "Ù‚Ù†Ø§", "Ø§Ù„Ø£Ù‚ØµØ±", "Ø£Ø³ÙˆØ§Ù†", "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯", "Ù…ØµØ± Ø§Ù„Ø¹Ù„ÙŠØ§"
  ],
  "Ø§Ù„Ù‡ÙŠØ¦Ø©": ["Ù‡ÙŠØ¦Ø©", "Ø§Ù„Ù‡ÙŠØ¦Ø©", "Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"]
};

// âš™ï¸ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§
function getRegion(inputName) {
  if (!inputName || typeof inputName !== "string") return "Ø§Ù„Ù‡ÙŠØ¦Ø©";
  inputName = inputName.trim();

  // 0ï¸âƒ£ Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ø·Ù„Ù‚Ø© Ù„Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ùˆ ÙÙŠÙ‡ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø«ÙŠØ© Ø£Ùˆ ØªØµÙ…ÙŠÙ…
  const hqKeywords = [
    "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø­Ù‚Ù„ÙŠØ©",
    "ØªØµÙ…ÙŠÙ… Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØµØ±Ù",
    "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø­Ù‚Ù„ÙŠØ©",
    "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØªØµÙ…ÙŠÙ… Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØµØ±Ù"
  ];
  if (hqKeywords.some(word => inputName.includes(word))) {
    return "Ø§Ù„Ù‡ÙŠØ¦Ø©";
  }

  // 1ï¸âƒ£ Ø£ÙˆÙ„Ø§Ù‹: ØªØ·Ø§Ø¨Ù‚ Ù…Ø¨Ø§Ø´Ø± ÙˆØµØ±ÙŠØ­ Ù„Ø¬Ù…Ù„ ÙˆØ§Ø¶Ø­Ø©
  for (const region of Object.keys(regionKeywords)) {
    const plainRegion = region.replace("Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ", "").trim();
    if (
      inputName.includes(region) ||
      inputName.includes(`Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù€${region}`) ||
      inputName.includes(`Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ø¥Ù‚Ù„ÙŠÙ… ${plainRegion}`) ||
      inputName.includes(`Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù€${plainRegion}`) ||
      inputName.includes(`Ø¥Ù‚Ù„ÙŠÙ… ${plainRegion}`)
    ) {
      return region;
    }
  }

  // 2ï¸âƒ£ Ø«Ø§Ù†ÙŠØ§Ù‹: ÙƒÙ„Ù…Ø§Øª ØµØ±ÙŠØ­Ø© (ÙƒÙ„Ù…Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ© = Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§)
  if (/\bØ§Ù„Ø´Ø±Ù‚ÙŠØ©\b/.test(inputName) || /\bØ§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©\b/.test(inputName)) {
    return "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù Ø´Ø±Ù‚ Ø§Ù„Ø¯Ù„ØªØ§";
  }

  // 3ï¸âƒ£ Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
  let bestMatch = "Ø§Ù„Ù‡ÙŠØ¦Ø©";
  let maxMatchLength = 0;

  for (const [region, keywords] of Object.entries(regionKeywords)) {
    for (const keyword of keywords) {
      if (inputName.includes(keyword)) {
        if (keyword.length > maxMatchLength) {
          bestMatch = region;
          maxMatchLength = keyword.length;
        }
      }
    }
  }

  // 4ï¸âƒ£ Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ù„Ùˆ Ù…ÙÙŠØ´ Ø£ÙŠ ØªØ·Ø§Ø¨Ù‚ â†’ Ø§Ù„Ù‡ÙŠØ¦Ø©
  return bestMatch;
}




  const deptTokens = deptNorm.split(/\s+/).filter(Boolean);

  // ğŸ” Ù†Ø¨Ø­Ø« Ø¨ØªØ´Ø§Ø¨Ù‡ 0.7 Ø£Ùˆ Ø£ÙƒØ«Ø±
  for (const [region, keywords] of Object.entries(regionKeywords)) {
    for (const kw of keywords) {
      const kwNorm = normalizeArabic(kw);
      for (const token of deptTokens) {
        const sim = similarity(token, kwNorm);
        if (deptNorm.includes(kwNorm) || sim >= 0.7) {
          detectedRegion = region;
          break;
        }
      }
      if (detectedRegion) break;
    }
    if (detectedRegion) break;
  }

  // âš™ï¸ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø£Ùˆ Ù…ØµÙ†Ø¹ Ø§Ù„Ù…ÙˆØ§Ø³ÙŠØ± Ø¨Ø¯ÙˆÙ† Ù…ÙˆÙ‚Ø¹
  if (!detectedRegion) {
    const hasFactory = deptNorm.includes("Ù…ØµÙ†Ø¹ Ù…ÙˆØ§Ø³ÙŠØ±");
    const hasTrainingCenter = deptNorm.includes("Ù…Ø±ÙƒØ² ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµØ±Ù");
    if ((hasFactory || hasTrainingCenter) && !deptNorm.match(/(Ø·Ù†Ø·Ø§|Ø²ÙØªÙ‰|ÙƒÙØ±|Ø§Ù„Ø²ÙŠØ§Øª|Ø§Ù„Ø¬ÙŠØ²Ù‡|Ø¯Ù…ÙŠØ§Ø·|Ø§Ù„Ø¨Ø­ÙŠØ±Ù‡|Ø§Ù„Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©)/)) {
      detectedRegion = "Ø¥Ù‚Ù„ÙŠÙ… ØµØ±Ù ÙˆØ³Ø· Ø§Ù„Ø¯Ù„ØªØ§";
    }
  }

  // âœ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙØ§ØªØ­ Ø«Ù‚ÙŠÙ„ ÙÙ‚Ø·
  if (detectedRegion && !originalDept.includes(detectedRegion)) {
    d.department = `${originalDept} - <span style="color: #ff1a1a; font-weight: 800;">${detectedRegion}</span>`;
  } else if (!detectedRegion) {
    console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…:", originalDept);
  }
}


        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ­Ø¯ Ø¨Ø£Ù…Ø§Ù† (ØªØ¬Ù†Ø¨ undefined)
        const combined = Object.values(d).map(v => v ? String(v) : '').join(" ").toLowerCase();
const recordDate = d.courseStart ? new Date(Date.parse(d.courseStart)) : null;
const inRange =
  (!fromDate || !toDate || (recordDate && recordDate >= fromDate && recordDate <= toDate)) &&
  (searchMonth === null || (recordDate && recordDate.getMonth() === searchMonth && recordDate.getFullYear() === searchYear));

        // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ø¨Ø¯ÙˆÙ† Ù‡Ù…Ø²Ø§Øª
        const normalizedCombined = normalizeArabic(combined);
const normalizedQuery = normalizeArabic(query);

// Ù„Ùˆ Ù…ÙÙŠØ´ Ø§Ø³ØªØ¹Ù„Ø§Ù…ØŒ Ù†Ø¹ØªØ¨Ø± ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
let matches = false;

if (!normalizedQuery) {
  matches = true;
} else {
  // Ù†Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù„Ù‰ -
  const subQueries = normalizedQuery.split("-").map(s => s.trim()).filter(Boolean);

  // AND: ÙƒÙ„ Ø´Ø±Ø· Ù„Ø§Ø²Ù… ÙŠØªØ­Ù‚Ù‚
  matches = subQueries.every(sub => {
    const escaped = escapeRegex(sub).replace(/\s+/g, '\\s+');
    const pattern = `(^|[^\\p{L}])${escaped}($|[^\\p{L}])`;
    try {
      const re = new RegExp(pattern, 'iu');
      return re.test(normalizedCombined);
    } catch (err) {
      const fallbackPattern = `(^|\\s)${escaped}($|\\s)`;
      const re2 = new RegExp(fallbackPattern, 'i');
      return re2.test(normalizedCombined);
    }
  });
}


        if (matches && inRange) {
          count++;

          // ØªØ£Ù…ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… recordDate (Ù„Ùˆ Ù…ÙÙŠØ´ ØªØ§Ø±ÙŠØ®ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®')
          const yearKey = recordDate ? String(recordDate.getFullYear()) : "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®";
          stats.byYear[yearKey] = (stats.byYear[yearKey] || 0) + 1;

          const formattedStart = d.courseStart ? new Date(d.courseStart).toLocaleDateString("en-GB") : "No Date";
          const courseDateKey = `${d.course || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'} (${formattedStart})`;
          stats.byCourseDate[courseDateKey] = (stats.byCourseDate[courseDateKey] || 0) + 1;

          const monthYear = recordDate ? recordDate.toLocaleString("en-GB", { month: "long", year: "numeric" }) : "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®";
          stats.byMonthYear[monthYear] = (stats.byMonthYear[monthYear] || 0) + 1;

// ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ù† Ø£ÙŠ Ø£ÙƒÙˆØ§Ø¯ HTML Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
const cleanDept = d.department ? d.department.replace(/<[^>]*>/g, '').trim() : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
// ğŸ” Ø¨Ø¯Ù„ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…
let regionOnly = "";
const regionMatch = d.department.match(/<span[^>]*>([^<]+)<\/span>|-?\s*([^<]+Ø¥Ù‚Ù„ÙŠÙ…\s+ØµØ±Ù[^\s<]*)/i);
if (regionMatch) {
  regionOnly = regionMatch[1] || regionMatch[2] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
} else {
  regionOnly = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
}
stats.byDepartment[regionOnly.trim()] = (stats.byDepartment[regionOnly.trim()] || 0) + 1;
          stats.byJob[d.job || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©"] = (stats.byJob[d.job || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©"] || 0) + 1;

          let residencyLabel = "ØºÙŠØ± Ù…Ù‚ÙŠÙ…/Ø©";
          const residencyType = (d.residency || '').trim();
          const gender = (d.gender || '').trim();

          if (residencyType.includes("ØºÙŠØ±")) {
            residencyLabel = gender === "Ø£Ù†Ø«Ù‰" ? "ØºÙŠØ± Ù…Ù‚ÙŠÙ…Ø©" : "ØºÙŠØ± Ù…Ù‚ÙŠÙ…";
          } else {
            residencyLabel = gender === "Ø£Ù†Ø«Ù‰" ? "Ù…Ù‚ÙŠÙ…Ø©" : "Ù…Ù‚ÙŠÙ…";
          }

          stats.byResidencyGender[residencyLabel] = (stats.byResidencyGender[residencyLabel] || 0) + 1;

          const row = document.createElement("tr");
          const fields = ["datetime","name","phone","email","department","qualification","job","residency","course","courseStart","courseEnd","trainerRating","contentRating","organizationRating","residencyRating","comments"];

         fields.forEach(field => {
  const cell = document.createElement("td");
  if (["datetime", "courseStart", "courseEnd"].includes(field)) {
    const rawDate = d[field];
    cell.textContent = rawDate
      ? new Date(rawDate).toLocaleDateString("en-GB", { year: "numeric", month: "long", day: "numeric" })
      : "";
  } else if (field === "department") {
    // ğŸ‘‡ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙƒÙ€ HTML
    cell.innerHTML = d[field] || "";
  } else {
    cell.textContent = d[field] || "";
  }


  
            cell.contentEditable = "true";
            cell.dataset.key = key;
            cell.dataset.field = field;
            cell.addEventListener("blur", function () {
              const key = Number(this.dataset.key);
              const field = this.dataset.field;
              const newValue = this.textContent.trim();
              const txUpdate = db.transaction("trainees", "readwrite");
              const storeUpdate = txUpdate.objectStore("trainees");
              const getRequest = storeUpdate.get(key);
              getRequest.onsuccess = function () {
                const data = getRequest.result;
                if (data && field in data) {
                  data[field] = newValue;
                  const updateRequest = storeUpdate.put(data);
                  updateRequest.onsuccess = () => console.log(`âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…ÙØªØ§Ø­ ${key}`);
                  updateRequest.onerror = (event) => console.error("âŒ ØªØ­Ø¯ÙŠØ« ÙØ´Ù„:", event.target.error);
                }
              };
            });
            row.appendChild(cell);
          });

          const deleteCell = document.createElement("td");
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "ğŸ—‘ Ø­Ø°Ù";
          deleteBtn.onclick = () => deleteRecord(key);
          deleteCell.appendChild(deleteBtn);
          row.appendChild(deleteCell);
          tbody.appendChild(row);
        }
      });

      if (count === 0) {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</td></tr>`;
        tableContainer.style.display = 'none';
        return;
      }

      // === Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ÙƒÙ…Ø§ ÙÙ‰ Ø§Ù„Ø£ØµÙ„ ===
      const statsDiv = document.createElement("div");
      statsDiv.id = "statsInfo";
      statsDiv.style.display = "flex";
      statsDiv.style.flexWrap = "nowrap";
      statsDiv.style.gap = "14px";
      statsDiv.style.margin = "10px 0";
      statsDiv.style.direction = "rtl";
      statsDiv.style.justifyContent = "space-between";

      const createCard = (title, icon, contentObj, bgColor, cardId) => {
        const card = document.createElement("div");
        card.style.backgroundColor = bgColor;
        card.style.border = "2px solid #003366";
        card.style.borderRadius = "10px";
        card.style.padding = "14px";
        card.style.color = "#003366";
        card.style.fontSize = "18px";
        card.style.textAlign = "center";
        card.style.width = "calc(100% / 6 - 12px)";
        card.style.height = "320px";
        card.style.overflowY = "auto";
        card.style.boxShadow = "0 4px 10px rgba(0,0,0,0.2)";
        card.style.display = "flex";
        card.style.flexDirection = "column";
        card.style.justifyContent = "flex-start";

        const header = document.createElement("div");
        header.textContent = `${icon} ${title}`;
        header.style.marginBottom = "10px";
        header.style.fontSize = "20px";
        header.style.backgroundColor = "#003366";
        header.style.color = "#ffffff";
        header.style.fontWeight = "bold";
        header.style.padding = "6px";
        header.style.borderRadius = "6px";

        const body = document.createElement("div");
        body.textContent = Object.entries(contentObj).map(([k, v]) => `${k}: ${v}`).join(" - ") || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
        body.style.fontWeight = "bold";
        body.style.fontSize = "18px";

        const canvas = document.createElement("canvas");
        canvas.id = `chart_${cardId}`;
        canvas.style.marginTop = "10px";
        canvas.style.maxHeight = "180px";
        canvas.style.maxWidth = "240px";
        canvas.style.alignSelf = "center";

        card.appendChild(header);
        card.appendChild(body);
        card.appendChild(canvas);
        return card;
      };

      const prepareChartData = (obj) => {
        const labels = Object.keys(obj);
        const data = Object.values(obj);
        const colors = labels.map(() => `hsl(${Math.random() * 360}, 70%, 60%)`);
        return { labels, data, colors };
      };

    // âœ… ÙƒØ§Ø±Øª Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©
statsDiv.appendChild(createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©", 
  "ğŸ“…", 
  stats.byYear, 
  "rgba(76, 175, 80, 0.15)", 
  "year"
));

// âœ… ÙƒØ§Ø±Øª Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆØªØ§Ø±ÙŠØ®Ù‡Ø§ (Ø¨Ø¯ÙˆÙ† Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø¯Ø©)
const courseDateCard = createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆØªØ§Ø±ÙŠØ®Ù‡Ø§", 
  "ğŸ“˜", 
  stats.byCourseDate, 
  "rgba(33, 150, 243, 0.15)", 
  "courseDate"
);
statsDiv.appendChild(courseDateCard);

// âœ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒØ±ÙˆØª
statsDiv.appendChild(createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©", 
  "ğŸ—“ï¸", 
  stats.byMonthYear, 
  "rgba(255, 152, 0, 0.15)", 
  "monthYear"
));

statsDiv.appendChild(createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…", 
  "ğŸ¢", 
  stats.byDepartment, 
  "rgba(0, 150, 136, 0.15)", 
  "department"
));

statsDiv.appendChild(createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¸ÙŠÙØ©", 
  "ğŸ’¼", 
  stats.byJob, 
  "rgba(156, 39, 176, 0.15)", 
  "job"
));

statsDiv.appendChild(createCard(
  "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© ÙˆØ§Ù„Ù†ÙˆØ¹", 
  "ğŸ ", 
  stats.byResidencyGender, 
  "rgba(244, 67, 54, 0.15)", 
  "residency"
));

      tableContainer.parentNode.insertBefore(statsDiv, tableContainer);
      tableContainer.style.display = 'block';

      const drawPieChart = (canvasId, chartData) => {
        const ctx = document.getElementById(canvasId).getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: chartData.labels,
            datasets: [{
              data: chartData.data,
              backgroundColor: chartData.colors,
              borderColor: "#fff",
              borderWidth: 1,
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" },
              tooltip: { enabled: true }
            }
          }
        });
      };

      drawPieChart("chart_year", prepareChartData(stats.byYear));
      drawPieChart("chart_courseDate", prepareChartData(stats.byCourseDate));
      drawPieChart("chart_monthYear", prepareChartData(stats.byMonthYear));
      drawPieChart("chart_department", prepareChartData(stats.byDepartment));
      drawPieChart("chart_job", prepareChartData(stats.byJob));
      drawPieChart("chart_residency", prepareChartData(stats.byResidencyGender));

      const statsBox = document.getElementById("statsInfo");
      const offset = statsBox.getBoundingClientRect().top + window.scrollY - 12;
      window.scrollTo({ top: offset, behavior: 'smooth' });
    }
  };
}


// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ© Ù…Ù…ÙƒÙ† ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§)
function parseArabicDate(dateStr) {
  // ÙØ±Ø¶Ø§Ù‹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø´ÙƒÙ„: ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©
  // ØªØ­ØªØ§Ø¬ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„ØªØ§Ø±ÙŠØ® JS Ø¹Ø§Ø¯ÙŠ
  // Ù…Ø«Ø§Ù„: "10/06/2025"
  if (!dateStr) return 0;
  const parts = dateStr.split("/");
  if (parts.length !== 3) return 0;
  const [day, month, year] = parts.map(Number);
  return new Date(year, month - 1, day).getTime();
}


function printResult() {
  const printContents = document.getElementById("resultScreen").innerHTML;
  const originalContents = document.body.innerHTML;

  document.body.innerHTML = printContents;
  window.print();
  document.body.innerHTML = originalContents;
  location.reload(); // ÙŠØ¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
}




function toggleForm() {
    var form = document.getElementById("registrationForm");
    if (form.style.display === "none" || form.style.display === "") {
      form.style.display = "block";
    } else {
      form.style.display = "none";
    }
  }


  function backupIndexedDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const allData = [];

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      allData.push(cursor.value);
      cursor.continue();
    } else {
      const json = JSON.stringify(allData, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "trainees_backup.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  };
}

function restoreIndexedDB(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);
      const tx = db.transaction("trainees", "readwrite");
      const store = tx.objectStore("trainees");

      data.forEach(item => {
        store.put(item);
      });

      tx.oncomplete = () => {
        alert("Database restored successfully.");
        location.reload();
      };
    } catch (err) {
      alert("Error restoring data. Make sure it's a valid JSON backup.");
      console.error(err);
    }
  };
  reader.readAsText(file);
}



function parseArabicDate(arabicDate) {
  if (!arabicDate) return new Date(0); // ØªØ§Ø±ÙŠØ® Ù‚Ø¯ÙŠÙ… Ø¬Ø¯Ù‹Ø§ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯

  try {
    // Ø­ÙˆÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    const westernDigits = arabicDate.replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d));

    // Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    const dateTimeParts = westernDigits.split(" ÙÙŠ ");
    if (dateTimeParts.length !== 2) return new Date(0);

    const [dayMonthYear, timePart] = dateTimeParts;

    // ØªØ±Ø¬Ù… Ø§Ù„Ø´Ù‡Ø±
    const months = {
      "ÙŠÙ†Ø§ÙŠØ±": "01",
      "ÙØ¨Ø±Ø§ÙŠØ±": "02",
      "Ù…Ø§Ø±Ø³": "03",
      "Ø£Ø¨Ø±ÙŠÙ„": "04",
      "Ù…Ø§ÙŠÙˆ": "05",
      "ÙŠÙˆÙ†ÙŠÙˆ": "06",
      "ÙŠÙˆÙ„ÙŠÙˆ": "07",
      "Ø£ØºØ³Ø·Ø³": "08",
      "Ø³Ø¨ØªÙ…Ø¨Ø±": "09",
      "Ø£ÙƒØªÙˆØ¨Ø±": "10",
      "Ù†ÙˆÙÙ…Ø¨Ø±": "11",
      "Ø¯ÙŠØ³Ù…Ø¨Ø±": "12"
    };

    const dayMonthYearMatch = dayMonthYear.match(/(\d{1,2}) (\S+) (\d{4})/);
    if (!dayMonthYearMatch) return new Date(0);

    const day = dayMonthYearMatch[1].padStart(2, '0');
    const month = months[dayMonthYearMatch[2]] || "01";
    const year = dayMonthYearMatch[3];

    // Ø§Ù„ÙˆÙ‚Øª Ù Ù¡:Ù¤Ù©:Ù¥Ù¢ Øµ Ø£Ùˆ Ù…
    let time = timePart.trim();
    let isPM = time.includes("Ù…");
    let timeDigits = time.replace(/[^\d:]/g, "");
    let [hh, mm, ss] = timeDigits.split(":").map(v => parseInt(v));
    if (isPM && hh < 12) hh += 12;
    if (!isPM && hh === 12) hh = 0;

    const isoString = `${year}-${month}-${day}T${String(hh).padStart(2, '0')}:${String(mm).padStart(2, '0')}:${String(ss).padStart(2, '0')}`;

    return new Date(isoString);
  } catch (e) {
    return new Date(0);
  }
}


function printStatsAndCharts() {
  // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø¸Ø§Ù‡Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
  document.getElementById('traineesTable').style.display = 'block';
  
  // Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
  setTimeout(() => {
    window.print();
  }, 300);
}




  window.onload = openDB;
</script>

<script>
  // ğŸ”‘ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯
  const APP_PASSWORD = "1611151dtc"; // ØºÙŠØ±Ù‡Ø§ Ø¨Ø±Ø§Ø­ØªÙƒ

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    const errorMsg = document.getElementById("errorMsg");

    if (input === APP_PASSWORD) {
      document.getElementById("loginScreen").style.display = "none";
    } else {
      errorMsg.style.display = "block";
    }
  }

  // Enter Ù…Ù† Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
  document.getElementById("passwordInput").addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
      checkPassword();
    }
  });
</script>


</body>
</html>
